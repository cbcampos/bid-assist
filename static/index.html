<!DOCTYPE html>
<html lang="en">
<head>

    <style>
    /* Mobile Optimizations */
    @media (max-width: 768px) {
        /* Sidebar - hide by default, show toggle */
        .sidebar { display: none; position: fixed; left: 0; top: 0; bottom: 0; width: 280px; z-index:9999; overflow-y:auto; }
        .sidebar.active { display: block; }
        .sidebar-overlay { display: none; position: fixed; inset: 0; bg-black bg-opacity-50 z-40; }
        .sidebar-overlay.active { display: block; }
        
        /* Main content - full width */
        .main-content { margin-left: 0 !important; padding: 1rem !important; }
        
        /* Tables - horizontal scroll */
        .table-scroll { overflow-x: auto; -webkit-overflow-scrolling: touch; }
        .table-scroll table { min-width: 600px; }
        
        /* Cards - stack on mobile */
        .grid-cols-2, .grid-cols-3, .grid-cols-4, .grid-cols-5 { grid-template-columns: 1fr !important; }
        
        /* Buttons - larger touch targets */
        button, .btn { min-height: 44px; min-width: 44px; padding: 12px 16px; }
        
        /* Text - readable on mobile */
        .text-xs, .text-sm { font-size: 14px !important; }
        
        /* Header actions - stack */
        .header-actions { flex-direction: column; gap: 8px; }
        .header-actions > * { width: 100%; }
        
        /* Modal - full screen on mobile */
        .modal-mobile { max-width: 100% !important; margin: 0 !important; border-radius: 0 !important; min-height: 100vh; }
        
        /* Stats cards */
        .stats-grid { grid-template-columns: 1fr 1fr !important; gap: 8px !important; }
        
        /* Hide non-essential on mobile */
        .hide-mobile { display: none !important; }
    }
    
    /* Touch-friendly improvements */
    button, a, select, input { touch-action: manipulation; }
    
    /* Sidebar toggle button (visible on mobile) */
    #mobile-menu-btn { display: none; }
    @media (max-width: 768px) {
        #mobile-menu-btn { display: flex !important; }
    }
    
    @media (max-width: 768px) {
        .sidebar {
            transform: translateX(-100%);
            transition: transform 0.3s ease-in-out;
        }
        .sidebar.active {
            transform: translateX(0);
        }
    }

</style>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>5B Contracting - Bid Management</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        brand: {
                            light: '#fef08a', 
                            DEFAULT: '#eab308', 
                            dark: '#ca8a04', 
                        },
                        dark: '#111827',
                    }
                }
            }
        }
    </script>
    <style>
        /* Print Styles for PDF Export */
        @media print {
            body { background-color: white; }
            .no-print { display: none !important; }
            .print-only { display: block !important; }
            .main-content { margin-left: 0 !important; width: 100% !important; padding: 0 !important; }
            .shadow-sm, .shadow-md { box-shadow: none !important; }
            .border { border: 1px solid #ddd !important; }
            .no-print-border { border: none !important; appearance: none !important; }
        }
        .print-only { display: none; }
        
        /* Smooth transitions */
        .fade-in { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Progress Bar Animation */
        .progress-bar { transition: width 1s ease-in-out; }
    
    @media (max-width: 768px) {
        .sidebar {
            transform: translateX(-100%);
            transition: transform 0.3s ease-in-out;
        }
        .sidebar.active {
            transform: translateX(0);
        }
    }

</style>
</head>
<body class="bg-gray-50 text-gray-800 font-sans">

    <!-- Sidebar (Hidden on Print) -->
    <aside class="no-print fixed inset-y-0 left-0 bg-dark text-white w-64 flex flex-col transition-transform z-20 sidebar">
        <div class="flex items-center justify-center h-16 bg-black border-b border-gray-800">
            <i class="fa-solid fa-truck-excavator text-brand text-2xl mr-2"></i>
            <span class="text-xl font-bold tracking-wider">BidAssist</span>
        </div>
        
        <div class="overflow-y-auto flex-1 pb-6">
            <nav class="px-4 py-4 space-y-1">
                <p class="px-4 text-xs font-bold text-gray-500 uppercase tracking-wider mb-2 mt-4">Estimating</p>
                <a href="#" id="nav-dashboard" onclick="switchView('dashboard')" class="flex items-center gap-3 px-4 py-3 bg-gray-800 text-brand rounded-lg transition">
                    <i class="fa-solid fa-chart-pie w-5 text-center"></i> Dashboard
                </a>
                <a href="#" id="nav-bid-editor" onclick="switchView('bid-editor')" class="flex items-center gap-3 px-4 py-3 text-gray-400 hover:text-white hover:bg-gray-800 rounded-lg transition">
                    <i class="fa-solid fa-file-signature w-5 text-center"></i> Active Bids
                </a>
                <a href="#" id="nav-rate-card" onclick="switchView('rate-card')" class="flex items-center gap-3 px-4 py-3 text-gray-400 hover:text-white hover:bg-gray-800 rounded-lg transition">
                    <i class="fa-solid fa-tags w-5 text-center"></i> Rate Card
                </a>

                <p class="px-4 text-xs font-bold text-gray-500 uppercase tracking-wider mb-2 mt-6">Operations (Q2)</p>
                <a href="#" id="nav-job-costing" onclick="switchView('job-costing')" class="flex items-center gap-3 px-4 py-3 text-gray-400 hover:text-white hover:bg-gray-800 rounded-lg transition">
                    <i class="fa-solid fa-calculator w-5 text-center"></i> Job Costing
                </a>
                <a href="#" id="nav-equipment" onclick="switchView('equipment')" class="flex items-center gap-3 px-4 py-3 text-gray-400 hover:text-white hover:bg-gray-800 rounded-lg transition">
                    <i class="fa-solid fa-tractor w-5 text-center"></i> Equipment Fleet
                </a>

                <p class="px-4 text-xs font-bold text-gray-500 uppercase tracking-wider mb-2 mt-6">CRM</p>
                <a href="#" id="nav-clients" onclick="switchView('clients')" class="flex items-center gap-3 px-4 py-3 text-gray-400 hover:text-white hover:bg-gray-800 rounded-lg transition">
                    <i class="fa-solid fa-users w-5 text-center"></i> Clients
                </a>
                <a href="#" id="nav-portal" onclick="switchView('portal')" class="flex items-center gap-3 px-4 py-3 text-gray-400 hover:text-white hover:bg-gray-800 rounded-lg transition">
                    </i> Client Portals</a><a href="#" id="nav-leads" onclick="switchView('leads')" class="flex items-center gap-3 px-4 py-3 text-gray-400 hover:text-white hover:bg-gray-800 rounded-lg transition"><i class="fa-solid fa-funnel-dollar w-5 text-center"></i> Leads</a><a href="#" id="nav-invoices" onclick="switchView('invoices')" class="flex items-center gap-3 px-4 py-3 text-gray-400 hover:text-white hover:bg-gray-800 rounded-lg transition"><i class="fa-solid fa-file-invoice-dollar w-5 text-center"></i> Invoices</a><a href="#" id="nav-weather" onclick="switchView('weather')" class="flex items-center gap-3 px-4 py-3 text-gray-400 hover:text-white hover:bg-gray-800 rounded-lg transition"><i class="fa-solid fa-cloud-sun w-5 text-center"></i> Weather</a><a href="#" id="nav-811" onclick="switchView('811')" class="flex items-center gap-3 px-4 py-3 text-gray-400 hover:text-white hover:bg-gray-800 rounded-lg transition"><i class="fa-solid fa-phone w-5 text-center"></i> 811</a><a href="#" id="nav-change-orders" onclick="switchView('change-orders')" class="flex items-center gap-3 px-4 py-3 text-gray-400 hover:text-white hover:bg-gray-800 rounded-lg transition"><i class="fa-solid fa-file-signature w-5 text-center"></i> Change Orders</a><a href="#" id="nav-subs" onclick="switchView('subs')" class="flex items-center gap-3 px-4 py-3 text-gray-400 hover:text-white hover:bg-gray-800 rounded-lg transition"><i class="fa-solid fa-users-cog w-5 text-center"></i> Subs</a><a href="#" id="nav-safety" onclick="switchView('safety')" class="flex items-center gap-3 px-4 py-3 text-gray-400 hover:text-white hover:bg-gray-800 rounded-lg transition"><i class="fa-solid fa-hard-hat w-5 text-center"></i> Safety</a><a href="#" id="nav-licensing" onclick="switchView('licensing')" class="flex items-center gap-3 px-4 py-3 text-gray-400 hover:text-white hover:bg-gray-800 rounded-lg transition"><i class="fa-solid fa-id-card w-5 text-center"></i> Licensing</a><a href="#" id="nav-team" onclick="switchView('team')" class="flex items-center gap-3 px-4 py-3 text-gray-400 hover:text-white hover:bg-gray-800 rounded-lg transition"><i class="fa-solid fa-user-group w-5 text-center"></i> Team</a><a href="#" id="nav-field-reports" onclick="switchView('field-reports')" class="flex items-center gap-3 px-4 py-3 text-gray-400 hover:text-white hover:bg-gray-800 rounded-lg transition"><i class="fa-solid fa-clipboard-list w-5 text-center"></i> Field Reports</a>
                </a>
            </nav>
        </div>

        <div class="p-4 border-t border-gray-800 mt-auto">
            <div class="flex items-center gap-3">
                <div class="w-8 h-8 rounded-full bg-brand text-dark flex items-center justify-center font-bold">R</div>
                <div>
                    <p class="text-sm font-medium">Ralph</p>
                    <p class="text-xs text-gray-400">5B Contracting</p>
                </div>
            </div>
        </div>
    </aside>

    <!-- Main Content -->
    
    <!-- Mobile Header -->
    <div class="md:hidden fixed top-0 left-0 right-0 bg-dark text-white z-50 flex items-center justify-between px-4 py-3 shadow-lg">
        <button onclick="toggleSidebar()" class="p-2 -ml-2">
            <i class="fa-solid fa-bars text-xl"></i>
        </button>
        <span class="font-bold text-lg">BidAssist</span>
        <div class="w-8"></div>
    </div>
    <!-- Spacer for fixed header -->
    <div class="md:hidden h-14"></div>

<main class="main-content ml-64 p-4 md:p-8 min-h-screen pt-16 md:pt-8">
        
        <!-- DYNAMIC HEADER -->
        <header class="no-print flex justify-between items-center mb-8">
            <div>
                <h1 id="page-title" class="text-2xl font-bold text-gray-900">Dashboard Overview</h1>
                <p id="page-subtitle" class="text-gray-500 text-sm">Welcome back. Here's your pipeline status.</p>
            </div>
            <div class="flex gap-3">
                <button class="px-4 py-2 bg-white border border-gray-300 rounded-lg text-sm font-medium hover:bg-gray-50 shadow-sm transition">
                    <i class="fa-regular fa-bell"></i>
                </button>
                <div id="header-actions">
                    <button onclick="switchView('bid-editor')" class="px-4 py-2 bg-brand text-dark font-bold rounded-lg hover:bg-brand-dark shadow-sm transition flex items-center gap-2">
                        <i class="fa-solid fa-plus"></i> New Bid
                    </button>
                </div>
            </div>
        </header>

        <!-- ========================================== -->
        <!-- VIEW: DASHBOARD -->
        <!-- ========================================== -->
        <div id="view-dashboard" class="fade-in block">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                <div class="bg-white p-6 rounded-xl border border-gray-200 shadow-sm border-t-4 border-t-blue-500">
                    <h3 class="text-gray-500 text-sm font-medium">Active Bids</h3>
                    <p class="text-3xl font-bold mt-2">12</p>
                    <p class="text-sm text-green-600 mt-2"><i class="fa-solid fa-arrow-trend-up"></i> +3 this week</p>
                </div>
                <div class="bg-white p-6 rounded-xl border border-gray-200 shadow-sm border-t-4 border-t-brand">
                    <h3 class="text-gray-500 text-sm font-medium">Total Pipeline</h3>
                    <p class="text-3xl font-bold mt-2">$425,000</p>
                    <p class="text-sm text-gray-500 mt-2">Across 12 pending projects</p>
                </div>
                <div class="bg-white p-6 rounded-xl border border-gray-200 shadow-sm border-t-4 border-t-green-500">
                    <h3 class="text-gray-500 text-sm font-medium">Win Rate</h3>
                    <p class="text-3xl font-bold mt-2">42%</p>
                    <p class="text-sm text-green-600 mt-2"><i class="fa-solid fa-arrow-trend-up"></i> Target: >40%</p>
                </div>
                <div class="bg-white p-6 rounded-xl border border-gray-200 shadow-sm border-t-4 border-t-purple-500">
                    <h3 class="text-gray-500 text-sm font-medium">YTD Revenue</h3>
                    <p class="text-3xl font-bold mt-2">$1.2M</p>
                    <p class="text-sm text-gray-500 mt-2">Closed Won</p>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                <div class="bg-white p-6 rounded-xl border border-gray-200 shadow-sm">
                    <h3 class="font-bold text-gray-800 mb-4">Revenue Trends</h3>
                    <canvas id="revenueChart" style="max-height: 300px;"></canvas>
                </div>
                <div class="bg-white p-6 rounded-xl border border-gray-200 shadow-sm">
                    <h3 class="font-bold text-gray-800 mb-4">Pipeline by Status</h3>
                    <div class="flex justify-center">
                        <canvas id="pipelineChart" style="max-height: 300px;"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- ========================================== -->
        <!-- VIEW: JOB COSTING (Q2) -->
        <!-- ========================================== -->
        <div id="view-job-costing" class="fade-in hidden">
            <!-- Job Costing KPIs -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="bg-white p-6 rounded-xl border border-gray-200 shadow-sm">
                    <div class="flex items-center gap-4">
                        <div class="p-3 bg-blue-100 text-blue-600 rounded-lg"><i class="fa-solid fa-helmet-safety text-xl"></i></div>
                        <div>
                            <h3 class="text-gray-500 text-sm font-medium">Active Jobs</h3>
                            <p class="text-2xl font-bold">4</p>
                        </div>
                    </div>
                </div>
                <div class="bg-white p-6 rounded-xl border border-gray-200 shadow-sm">
                    <div class="flex items-center gap-4">
                        <div class="p-3 bg-red-100 text-red-600 rounded-lg"><i class="fa-solid fa-chart-line text-xl"></i></div>
                        <div>
                            <h3 class="text-gray-500 text-sm font-medium">Avg Profit Margin (Actual)</h3>
                            <p class="text-2xl font-bold">12.4% <span class="text-sm text-red-500 font-normal">(-2.6% vs Est)</span></p>
                        </div>
                    </div>
                </div>
                <div class="bg-white p-6 rounded-xl border border-gray-200 shadow-sm">
                    <div class="flex items-center gap-4">
                        <div class="p-3 bg-green-100 text-green-600 rounded-lg"><i class="fa-solid fa-file-invoice-dollar text-xl"></i></div>
                        <div>
                            <h3 class="text-gray-500 text-sm font-medium">Total WIP Billed</h3>
                            <p class="text-2xl font-bold">$185,400</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Active Jobs Table -->
            <div class="bg-white rounded-xl border border-gray-200 shadow-sm overflow-hidden">
                <div class="table-scroll"><table class="w-full text-left border-collapse">
                    <thead>
                        <tr class="bg-gray-50 text-gray-500 text-xs uppercase tracking-wider border-b border-gray-200">
                            <th class="px-6 py-4 font-bold">Project / Client</th>
                            <th class="px-6 py-4 font-bold text-right">Estimated Cost</th>
                            <th class="px-6 py-4 font-bold text-right">Actual Cost</th>
                            <th class="px-6 py-4 font-bold w-1/4">Budget Used</th>
                            <th class="px-6 py-4 font-bold text-center">Status</th>
                        </tr>
                    </thead>
                    <tbody id="job-costing-body" class="text-sm">
                        <!-- Populated by JS -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- ========================================== -->
        <!-- VIEW: EQUIPMENT FLEET (Q2) -->
        <!-- ========================================== -->
        <div id="view-equipment" class="fade-in hidden">
            <!-- Filter Bar -->
            <div class="flex justify-between items-center mb-6">
                <div class="flex gap-4">
                    <select class="border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-brand focus:border-brand bg-white shadow-sm">
                        <option>All Equipment</option>
                        <option>Excavators</option>
                        <option>Dozers</option>
                        <option>Loaders</option>
                        <option>Trucks</option>
                    </select>
                    <select class="border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-brand focus:border-brand bg-white shadow-sm">
                        <option>All Statuses</option>
                        <option>Active</option>
                        <option>Maintenance</option>
                        <option>Idle</option>
                    </select>
                </div>
            </div>

            <!-- Equipment Grid -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="equipment-grid">
                <!-- Populated by JS -->
            </div>
        </div>

        <!-- ========================================== -->
        <!-- VIEW: CLIENT PORTAL (Q2) -->
        <!-- ========================================== -->
        <div id="view-portal" class="fade-in hidden">
            <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-8 flex items-start gap-4 text-blue-800">
                <i class="fa-solid fa-circle-info mt-1"></i>
                <div>
                    <h3 class="font-bold">Client Portals are Active</h3>
                    <p class="text-sm mt-1">Share these secure links with your clients so they can view, approve, and track their bids in real-time. Changes made in the Bid Editor will instantly reflect on their portal.</p>
                </div>
            </div>

            <div class="bg-white rounded-xl border border-gray-200 shadow-sm overflow-hidden">
                <div class="table-scroll"><table class="w-full text-left border-collapse">
                    <thead>
                        <tr class="bg-gray-50 text-gray-500 text-xs uppercase tracking-wider border-b border-gray-200">
                            <th class="px-6 py-4 font-bold">Client Company</th>
                            <th class="px-6 py-4 font-bold text-center">Active Jobs</th>
                            <th class="px-6 py-4 font-bold text-center">Pending Bids</th>
                            <th class="px-6 py-4 font-bold">Last Client Login</th>
                            <th class="px-6 py-4 font-bold text-right">Portal Link</th>
                        </tr>
                    </thead>
                    <tbody id="portal-body" class="text-sm">
                        <!-- Populated by JS -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- ========================================== -->
        <!-- VIEW: BID EDITOR (MVP) -->
        <!-- ========================================== -->
        <div id="view-bid-editor" class="fade-in hidden">
            <div class="no-print flex justify-between items-center bg-white p-4 rounded-xl border border-gray-200 shadow-sm mb-6">
                <div class="flex items-center gap-4 text-sm">
                    <span class="text-gray-500">Select Bid:</span>
                <select id="bid-selector" onchange="loadBid(this.value)" class="border-gray-300 rounded-md shadow-sm focus:ring-brand focus:border-brand text-sm font-medium">
                    <option value="1">Prattville Shopping Center</option>
                    <option value="2">Wetumpka Sewer Main Extension</option>
                    <option value="3">Montgomery Storage Facility</option>
                    <option value="4">Hillcrest Drive Residential</option>
                </select>
                <span class="text-gray-500 ml-4">Status:</span>
                    <select id="bid-status" onchange="updateBidStatus(this.value)" class="border-gray-300 rounded-md shadow-sm focus:ring-brand focus:border-brand text-sm font-medium">
                        <option value="Draft">Draft</option>
                        <option value="Submitted">Submitted</option>
                        <option value="Won">Won</option>
                        <option value="Lost">Lost</option>
                    </select>
                </div>
                <div class="flex gap-2">
                    <button onclick="window.print()" class="px-4 py-2 bg-gray-800 text-white rounded-lg text-sm font-medium hover:bg-gray-900 transition shadow-sm">
                        <i class="fa-regular fa-file-pdf mr-1"></i> Export PDF
                    </button>
                    <button onclick="emailBid()" class="px-4 py-2 bg-brand text-dark font-bold rounded-lg text-sm hover:bg-brand-dark transition shadow-sm">
                        <i class="fa-regular fa-paper-plane mr-1"></i> Email Bid
                    </button>
                </div>
            </div>

            <div id="printable-bid" class="bg-white p-8 md:p-12 rounded-xl border border-gray-200 shadow-sm">
                <!-- Bid Content (Truncated for brevity, fully functional via JS) -->
                <div class="flex justify-between items-start mb-12 border-b border-gray-200 pb-8">
                    <div>
                        <h2 class="text-3xl font-bold text-gray-900 tracking-tight">BID PROPOSAL</h2>
                        <div class="mt-4 text-sm text-gray-600 leading-relaxed">
                            <strong>5B Contracting LLC</strong><br>Montgomery, AL<br>(334) 868-4758<br>lee@5bcontracting.com
                        </div>
                    </div>
                    <div class="text-right">
                        <p class="text-sm text-gray-500">Prepared For:</p>
                        <p id="bid-client" class="text-lg font-bold text-gray-900">Client Name</p>
                        <p id="bid-client-address" class="text-sm text-gray-600">Address</p>
                        <p class="text-sm text-gray-500 mt-2">Date: <span id="bid-date"></span></p>
                    </div>
                </div>
                
                <h3 class="text-lg font-bold text-gray-900 mb-4 border-b-2 border-brand pb-2">Scope of Work & Pricing</h3>
                <div class="table-scroll"><table class="w-full text-left" id="line-items-table">
                    <thead>
                        <tr class="text-xs font-bold text-gray-500 uppercase tracking-wider border-b border-gray-200 bg-gray-50">
                            <th class="p-3 w-1/4">Category</th>
                            <th class="p-3 w-1/3">Description</th>
                            <th class="p-3 w-24 text-center">Qty</th>
                            <th class="p-3 w-32 text-right">Unit Cost</th>
                            <th class="p-3 w-32 text-right">Total</th>
                        </tr>
                    </thead>
                    <tbody id="line-items-body" class="text-sm"></tbody>
                </table>
                <button onclick="addLineItem()" class="no-print mt-4 text-brand-dark font-medium text-sm hover:underline"><i class="fa-solid fa-circle-plus"></i> Add Item</button>

                <div class="flex justify-end border-t border-gray-200 pt-6">
                    <div class="w-72">
                        <div class="flex justify-between py-2 text-sm">
                            <span class="text-gray-500">Subtotal:</span>
                            <span id="subtotal-val" class="font-medium">$0.00</span>
                        </div>
                        <div class="flex justify-between py-3 mt-2 border-t-2 border-gray-800 text-lg font-bold">
                            <span class="text-gray-900">Total Bid:</span>
                            <span id="grand-total-val" class="text-brand-dark">$0.00</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ========================================== -->
        <!-- VIEW: CLIENTS (MVP) -->
        <!-- ========================================== -->
        <div id="view-clients" class="fade-in hidden">
            <div class="bg-white rounded-xl border border-gray-200 shadow-sm overflow-hidden">
                <div class="table-scroll"><table class="w-full text-left border-collapse">
                    <thead>
                        <tr class="bg-gray-50 text-gray-500 text-sm border-b border-gray-200">
                            <th class="px-6 py-4 font-medium">Company Name</th>
                            <th class="px-6 py-4 font-medium">Primary Contact</th>
                            <th class="px-6 py-4 font-medium">Email Address</th>
                            <th class="px-6 py-4 font-medium text-right">Jobs</th>
                            <th class="px-6 py-4 font-medium text-right">Revenue</th>
                        </tr>
                    </thead>
                    <tbody class="text-sm" id="clients-body"></tbody>
                </table>
            </div>
        </div>

        <!-- ========================================== -->
        <!-- VIEW: RATE CARD (MVP) -->
        <!-- ========================================== -->
        <div id="view-rate-card" class="fade-in hidden">
            <div class="bg-white rounded-xl border border-gray-200 shadow-sm overflow-hidden">
                <div class="table-scroll"><table class="w-full text-left border-collapse">
                    <thead>
                        <tr class="bg-gray-50 text-gray-500 text-sm border-b border-gray-200">
                            <th class="px-6 py-4 font-medium">Category</th>
                            <th class="px-6 py-4 font-medium">Description</th>
                            <th class="px-6 py-4 font-medium text-right">Unit Cost</th>
                            <th class="px-6 py-4 font-medium">Unit</th>
                        </tr>
                    </thead>
                    <tbody class="text-sm" id="rate-card-body"></tbody>
                </table></div>
            </div>
        </div>

    
        <!-- VIEW: LEADS -->
        <div id="view-leads" class="fade-in hidden">
            <div class="bg-white rounded-xl border border-gray-200 shadow-sm overflow-hidden">
                <div class="table-scroll"><table class="w-full text-left"><thead><tr class="bg-gray-50 text-gray-500 text-xs uppercase"><th class="px-6 py-4">Company</th><th class="px-6 py-4">Contact</th><th class="px-6 py-4">Source</th><th class="px-6 py-4 text-right">Value</th><th class="px-6 py-4">Status</th></tr></thead><tbody id="leads-body" class="text-sm"></tbody></table></div>
            </div>
        </div>

        <!-- VIEW: INVOICES -->
        <div id="view-invoices" class="fade-in hidden">
            <div class="bg-white rounded-xl border border-gray-200 shadow-sm overflow-hidden">
                <div class="table-scroll"><table class="w-full text-left"><thead><tr class="bg-gray-50 text-gray-500 text-xs uppercase"><th class="px-6 py-4">Invoice #</th><th class="px-6 py-4">Client</th><th class="px-6 py-4 text-right">Amount</th><th class="px-6 py-4">Status</th><th class="px-6 py-4">Due Date</th></tr></thead><tbody id="invoices-body" class="text-sm"></tbody></table></div>
            </div>
        </div>

        <!-- VIEW: 811 TICKETS -->
        <div id="view-811" class="fade-in hidden">
            <div class="bg-white rounded-xl border border-gray-200 shadow-sm overflow-hidden">
                <div class="table-scroll"><table class="w-full text-left"><thead><tr class="bg-gray-50 text-gray-500 text-xs uppercase"><th class="px-6 py-4">Ticket #</th><th class="px-6 py-4">Location</th><th class="px-6 py-4">Status</th><th class="px-6 py-4">Expires</th></tr></thead><tbody id="tickets-body" class="text-sm"></tbody></table></div>
            </div>
        </div>

        <!-- VIEW: CHANGE ORDERS -->
        <div id="view-change-orders" class="fade-in hidden">
            <div class="bg-white rounded-xl border border-gray-200 shadow-sm overflow-hidden">
                <div class="table-scroll"><table class="w-full text-left"><thead><tr class="bg-gray-50 text-gray-500 text-xs uppercase"><th class="px-6 py-4">Project</th><th class="px-6 py-4">Description</th><th class="px-6 py-4 text-right">Amount</th><th class="px-6 py-4">Status</th></tr></thead><tbody id="co-body" class="text-sm"></tbody></table></div>
            </div>
        </div>

        <!-- VIEW: SUBCONTRACTORS -->
        <div id="view-subs" class="fade-in hidden">
            <div class="bg-white rounded-xl border border-gray-200 shadow-sm overflow-hidden">
                <div class="table-scroll"><table class="w-full text-left"><thead><tr class="bg-gray-50 text-gray-500 text-xs uppercase"><th class="px-6 py-4">Company</th><th class="px-6 py-4">Trade</th><th class="px-6 py-4">Contact</th><th class="px-6 py-4">Status</th></tr></thead><tbody id="subs-body" class="text-sm"></tbody></table></div>
            </div>
        </div>

        <!-- VIEW: SAFETY -->
        <div id="view-safety" class="fade-in hidden">
            <div class="grid grid-cols-3 gap-6 mb-6">
                <div class="bg-white p-6 rounded-xl border shadow-sm"><h3 class="text-gray-500 text-sm">Incidents (YTD)</h3><p class="text-3xl font-bold mt-2">0</p></div>
                <div class="bg-white p-6 rounded-xl border shadow-sm"><h3 class="text-gray-500 text-sm">Safety Meetings</h3><p class="text-3xl font-bold mt-2">12</p></div>
                <div class="bg-white p-6 rounded-xl border shadow-sm"><h3 class="text-gray-500 text-sm">Days Without Incident</h3><p class="text-3xl font-bold mt-2 text-green-600">45</p></div>
            </div>
            <div class="bg-white rounded-xl border border-gray-200 shadow-sm overflow-hidden">
                <div class="table-scroll"><table class="w-full text-left"><thead><tr class="bg-gray-50 text-gray-500 text-xs uppercase"><th class="px-6 py-4">Date</th><th class="px-6 py-4">Type</th><th class="px-6 py-4">Location</th><th class="px-6 py-4">Status</th></tr></thead><tbody class="text-sm"><tr><td colspan="4" class="p-4 text-center text-gray-500">No incidents recorded</td></tr></tbody></table></div>
            </div>
        </div>

        <!-- VIEW: LICENSING -->
        <div id="view-licensing" class="fade-in hidden">
            <div class="grid grid-cols-3 gap-6 mb-6">
                <div class="bg-white p-6 rounded-xl border shadow-sm border-t-4 border-t-green-500"><h3 class="text-gray-500 text-sm">Business License</h3><p class="text-2xl font-bold mt-2">Active</p><p class="text-sm text-gray-500 mt-1">Expires: Dec 2026</p></div>
                <div class="bg-white p-6 rounded-xl border shadow-sm border-t-4 border-t-green-500"><h3 class="text-gray-500 text-sm">General Liability</h3><p class="text-2xl font-bold mt-2">$2M</p><p class="text-sm text-gray-500 mt-1">Expires: Jun 2026</p></div>
                <div class="bg-white p-6 rounded-xl border shadow-sm border-t-4 border-t-yellow-500"><h3 class="text-gray-500 text-sm">Equipment Policy</h3><p class="text-2xl font-bold mt-2">$500K</p><p class="text-sm text-gray-500 mt-1">Expires: Mar 2026</p></div>
            </div>
        </div>

        <!-- VIEW: TEAM -->
        <div id="view-team" class="fade-in hidden">
            <div class="bg-white rounded-xl border border-gray-200 shadow-sm overflow-hidden">
                <div class="table-scroll"><table class="w-full text-left"><thead><tr class="bg-gray-50 text-gray-500 text-xs uppercase"><th class="px-6 py-4">Name</th><th class="px-6 py-4">Role</th><th class="px-6 py-4">Email</th><th class="px-6 py-4">Status</th></tr></thead><tbody class="text-sm"><tr><td class="px-6 py-4 font-bold">Lee (Owner)</td><td class="px-6 py-4">Owner</td><td class="px-6 py-4">lee@5bcontracting.com</td><td class="px-6 py-4"><span class="px-2 py-1 bg-green-100 text-green-800 rounded text-xs font-bold">Active</span></td></tr></tbody></table></div>
            </div>
        </div>

        <!-- VIEW: FIELD REPORTS -->
        <div id="view-field-reports" class="fade-in hidden">
            <div class="grid grid-cols-3 gap-6 mb-6">
                <div class="bg-white p-6 rounded-xl border shadow-sm"><h3 class="text-gray-500 text-sm">Today's Reports</h3><p class="text-3xl font-bold mt-2">2</p></div>
                <div class="bg-white p-6 rounded-xl border shadow-sm"><h3 class="text-gray-500 text-sm">This Week</h3><p class="text-3xl font-bold mt-2">8</p></div>
                <div class="bg-white p-6 rounded-xl border shadow-sm"><h3 class="text-gray-500 text-sm">Total Hours</h3><p class="text-3xl font-bold mt-2">156</p></div>
            </div>
            <div class="bg-white rounded-xl border border-gray-200 shadow-sm overflow-hidden">
                <div class="table-scroll"><table class="w-full text-left"><thead><tr class="bg-gray-50 text-gray-500 text-xs uppercase"><th class="px-6 py-4">Date</th><th class="px-6 py-4">Project</th><th class="px-6 py-4">Crew</th><th class="px-6 py-4">Hours</th><th class="px-6 py-4">Notes</th></tr></thead><tbody id="fr-body" class="text-sm"></tbody></table></div>
            </div>
        </div>

        <!-- VIEW: WEATHER -->
        <div id="view-weather" class="fade-in hidden">
            <div class="grid grid-cols-2 md:grid-cols-5 gap-3 md:gap-4 mb-4 md:mb-6">
                <div class="bg-gradient-to-br from-blue-500 to-blue-600 text-white p-6 rounded-xl"><p class="text-sm opacity-90">Today</p><p class="text-4xl font-bold mt-2">72°</p><p class="text-sm opacity-90">Sunny</p></div>
                <div class="bg-white p-6 rounded-xl border"><p class="text-gray-500 text-sm">Tomorrow</p><p class="text-3xl font-bold mt-2">68°</p><p class="text-sm text-gray-500">Partly Cloudy</p></div>
                <div class="bg-white p-6 rounded-xl border border-red-300"><p class="text-red-500 text-sm">Wed</p><p class="text-3xl font-bold mt-2">45°</p><p class="text-sm text-red-500 font-bold">80% Rain</p></div>
                <div class="bg-white p-6 rounded-xl border"><p class="text-gray-500 text-sm">Thu</p><p class="text-3xl font-bold mt-2">52°</p><p class="text-sm text-gray-500">30% Rain</p></div>
                <div class="bg-white p-6 rounded-xl border"><p class="text-gray-500 text-sm">Fri</p><p class="text-3xl font-bold mt-2">58°</p><p class="text-sm text-gray-500">Sunny</p></div>
            </div>
            <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6"><p class="font-bold text-yellow-800"><i class="fa-solid fa-triangle-exclamation mr-2"></i>Rain expected Wednesday - Consider delaying concrete pours</p></div>
        </div>

</main>

    <!-- JavaScript Logic -->
    <script>
        // ==========================================
        // 1. DATA STATE (MVP + Q2 DUMMY DATA)
        // ==========================================
        let lineItems =[
            { id: 1, category: 'Mobilization', desc: 'Move in equipment', qty: 1, cost: 1500.00 },
            { id: 2, category: 'Excavation', desc: 'Cut to subgrade', qty: 1200, cost: 12.50 }
        ];

        const clientsData =[
        { id: 1, company: 'Apex Development Group', contact: 'Sarah Mitchell', phone: '(334) 555-0103', email: 'sarah@apexdev.com', address: '789 Commerce Way, Wetumpka, AL', totalBids: 15, wins: 9, revenue: 620000, lastBid: '2026-02-22' },
        { id: 2, company: 'City of Wetumpka', contact: 'Public Works Dept', phone: '(334) 567-0100', email: 'publicworks@wetumpka.gov', address: '100 City Hall Dr, Wetumpka, AL', totalBids: 4, wins: 3, revenue: 285000, lastBid: '2026-02-20' },
        { id: 3, company: 'Southeast Storage LLC', contact: 'Tom Richardson', phone: '(334) 555-0110', email: 'tom@southeaststorage.com', address: '8800 Atlanta Hwy, Montgomery, AL', totalBids: 3, wins: 2, revenue: 145000, lastBid: '2026-02-18' },
        { id: 4, company: 'Lee Properties', contact: 'James Lee', phone: '(334) 868-4758', email: 'james@leeproperties.com', address: '200 Commerce St, Montgomery, AL', totalBids: 8, wins: 6, revenue: 380000, lastBid: '2026-02-21' },
        { id: 5, company: 'Prattville Medical Center', contact: 'Facilities Director', phone: '(334) 555-0120', email: 'facilities@prattvillemed.org', address: '124 McQueen Smith Rd, Prattville, AL', totalBids: 2, wins: 1, revenue: 95000, lastBid: '2026-02-15' }
    ];

        const rateCardData =[
        { id: 1, cat: 'Equipment', desc: 'CAT 320 Excavator (36,000 lbs)', cost: 175.00, unit: 'hour' },
        { id: 2, cat: 'Equipment', desc: 'CAT 336 Excavator (84,000 lbs)', cost: 225.00, unit: 'hour' },
        { id: 3, cat: 'Equipment', desc: 'CAT D6 Dozer', cost: 185.00, unit: 'hour' },
        { id: 4, cat: 'Equipment', desc: 'CAT 950M Wheel Loader', cost: 125.00, unit: 'hour' },
        { id: 5, cat: 'Equipment', desc: 'CAT 140M Motor Grader', cost: 145.00, unit: 'hour' },
        { id: 6, cat: 'Equipment', desc: 'Dump Truck (10-yard)', cost: 85.00, unit: 'hour' },
        { id: 7, cat: 'Equipment', desc: 'Water Truck', cost: 95.00, unit: 'hour' },
        { id: 8, cat: 'Equipment', desc: 'Skid Steer Loader', cost: 65.00, unit: 'hour' },
        { id: 9, cat: 'Labor', desc: 'Heavy Equipment Operator', cost: 45.00, unit: 'hour' },
        { id: 10, cat: 'Labor', desc: 'Laborer', cost: 28.00, unit: 'hour' },
        { id: 11, cat: 'Labor', desc: 'Foreman', cost: 55.00, unit: 'hour' },
        { id: 12, cat: 'Labor', desc: 'CDL Driver', cost: 32.00, unit: 'hour' },
        { id: 13, cat: 'Materials', desc: 'Crush Run (CR-6)', cost: 28.00, unit: 'ton' },
        { id: 14, cat: 'Materials', desc: '#57 Stone', cost: 32.00, unit: 'ton' },
        { id: 15, cat: 'Materials', desc: '#789 Granite', cost: 38.00, unit: 'ton' },
        { id: 16, cat: 'Materials', desc: 'Topsoil', cost: 22.00, unit: 'yard' },
        { id: 17, cat: 'Services', desc: 'Excavation (common earth)', cost: 4.50, unit: 'yard' },
        { id: 18, cat: 'Services', desc: 'Backfill (compacted)', cost: 8.00, unit: 'yard' },
        { id: 19, cat: 'Services', desc: 'Final Grade', cost: 0.45, unit: 'sq ft' },
        { id: 20, cat: 'Services', desc: 'Hauling (per mile)', cost: 3.50, unit: 'mile' }
    ];

        // Q2 Features Data
        const jobCostingData =[
            { id: 1, project: 'Prattville Shopping Center', client: 'Apex Development', est: 125000, actual: 98500, status: 'In Progress' },
            { id: 2, project: 'Wetumpka Sewer Main', client: 'City of Wetumpka', est: 185000, actual: 142000, status: 'In Progress' },
            { id: 3, project: 'Hillcrest Drive Residential', client: 'Lee Properties', est: 45000, actual: 38500, status: 'Completed' },
            { id: 4, project: 'Montgomery Storage Facility', client: 'Southeast Storage', est: 95000, actual: 98000, status: 'Over Budget' },
            { id: 5, project: 'Eastgate Plaza', client: 'Coleman Dev', est: 78000, actual: 72000, status: 'Completed' }
        ];

        const equipmentData =[
            { id: 'EQ-01', name: 'Cat 320 Excavator', type: 'Excavator', status: 'Active', location: 'Highland Subdiv', hours: 4520, nextService: '4600 hrs' },
            { id: 'EQ-04', name: 'Deere 35G Mini', type: 'Excavator', status: 'Maintenance', location: 'Shop', hours: 1250, nextService: 'In Shop (Hydraulics)' },
            { id: 'EQ-08', name: 'JD 650K Dozer', type: 'Dozer', status: 'Active', location: 'City Water Main', hours: 3100, nextService: '3200 hrs' },
            { id: 'EQ-12', name: 'Mack Dump Truck', type: 'Truck', status: 'Idle', location: 'Yard', hours: 8540, nextService: '9000 hrs' },
            { id: 'EQ-15', name: 'Cat 289D Skid Steer', type: 'Loader', status: 'Active', location: 'Smith Foundation', hours: 2100, nextService: '2500 hrs' }
        ];

        const portalData =[
        { client: 'Apex Development Group', active: 3, pending: 2, lastLogin: 'Today, 9:45 AM', code: 'apex-8f2a' },
        { client: 'City of Wetumpka', active: 1, pending: 0, lastLogin: 'Yesterday, 2:30 PM', code: 'wetumpka-3k1b' },
        { client: 'Lee Properties', active: 2, pending: 1, lastLogin: 'Today, 11:00 AM', code: 'lee-9x4p' },
        { client: 'Southeast Storage LLC', active: 1, pending: 0, lastLogin: 'Feb 20, 2026', code: 'se storage-2m7n' }
    ];

        // ==========================================
        // 2. VIEW SWITCHING LOGIC
        // ==========================================
        const views =['dashboard', 'bid-editor', 'clients', 'rate-card', 'job-costing', 'equipment', 'portal', 'leads', 'invoices', '811', 'change-orders', 'subs', 'safety', 'licensing', 'team', 'field-reports', 'weather'];
        
        function switchView(viewName) {
            // Hide all
            views.forEach(v => {
                document.getElementById('view-' + v).classList.add('hidden');
                const navBtn = document.getElementById('nav-' + v);
                navBtn.classList.remove('bg-gray-800', 'text-white', 'text-brand');
                navBtn.classList.add('text-gray-400');
            });
            
            // Show target
            document.getElementById('view-' + viewName).classList.remove('hidden');
            const activeNav = document.getElementById('nav-' + viewName);
            activeNav.classList.remove('text-gray-400');
            activeNav.classList.add('bg-gray-800', viewName === 'dashboard' ? 'text-brand' : 'text-white');

            // Dynamic Header Text
            const title = document.getElementById('page-title');
            const sub = document.getElementById('page-subtitle');
            const actions = document.getElementById('header-actions');
            
            const headers = {
                'dashboard': { t: 'Dashboard Overview', s: "Welcome back. Here's your pipeline status.", a: '<button onclick="switchView(\'bid-editor\')" class="px-4 py-2 bg-brand text-dark font-bold rounded-lg hover:bg-brand-dark shadow-sm transition"><i class="fa-solid fa-plus mr-2"></i>New Bid</button>' },
                'bid-editor': { t: 'Bid Editor', s: 'Editing: Select a bid', a: '' },
                'clients': { t: 'Client Database', s: 'Manage your customers and contacts.', a: '<button class="px-4 py-2 bg-brand text-dark font-bold rounded-lg hover:bg-brand-dark shadow-sm"><i class="fa-solid fa-user-plus mr-2"></i>Add Client</button>' },
                'rate-card': { t: 'Rate Card', s: 'Standard pricing for estimating.', a: '<button class="px-4 py-2 bg-brand text-dark font-bold rounded-lg hover:bg-brand-dark shadow-sm"><i class="fa-solid fa-tag mr-2"></i>Add Rate</button>' },
                'job-costing': { t: 'Job Costing (WIP)', s: 'Track estimated vs actual costs in real-time.', a: '<button class="px-4 py-2 bg-white border border-gray-300 rounded-lg text-sm font-medium hover:bg-gray-50"><i class="fa-solid fa-file-csv mr-2"></i>Export CSV</button>' },
                'equipment': { t: 'Equipment Fleet', s: 'Track machine locations, hours, and maintenance.', a: '<button class="px-4 py-2 bg-brand text-dark font-bold rounded-lg hover:bg-brand-dark shadow-sm"><i class="fa-solid fa-plus mr-2"></i>Add Machine</button>' },
                'portal': { t: 'Client Portals', s: 'Manage external access links for your clients.', a: '' },
                'leads': { t: 'Leads', s: 'Track prospects to bids.', a: '<button class="px-4 py-2 bg-brand text-dark font-bold rounded-lg"><i class="fa-solid fa-plus mr-2"></i>Add Lead</button>' },
                'invoices': { t: 'Invoices', s: 'Create and track invoices.', a: '<button class="px-4 py-2 bg-brand text-dark font-bold rounded-lg"><i class="fa-solid fa-plus mr-2"></i>New Invoice</button>' },
                '811': { t: '811 Tickets', s: 'One-Call ticket tracking.', a: '<button class="px-4 py-2 bg-brand text-dark font-bold rounded-lg"><i class="fa-solid fa-plus mr-2"></i>New Ticket</button>' },
                'change-orders': { t: 'Change Orders', s: 'Scope change management.', a: '<button class="px-4 py-2 bg-brand text-dark font-bold rounded-lg"><i class="fa-solid fa-plus mr-2"></i>New CO</button>' },
                'subs': { t: 'Subcontractors', s: 'Sub database & availability.', a: '<button class="px-4 py-2 bg-brand text-dark font-bold rounded-lg"><i class="fa-solid fa-plus mr-2"></i>Add Sub</button>' },
                'safety': { t: 'Safety', s: 'OSHA compliance & incidents.', a: '<button class="px-4 py-2 bg-brand text-dark font-bold rounded-lg"><i class="fa-solid fa-plus mr-2"></i>Report Incident</button>' },
                'licensing': { t: 'Licensing', s: 'Permits & insurance.', a: '<button class="px-4 py-2 bg-brand text-dark font-bold rounded-lg"><i class="fa-solid fa-plus mr-2"></i>Add License</button>' },
                'team': { t: 'Team', s: 'Manage users & roles.', a: '<button class="px-4 py-2 bg-brand text-dark font-bold rounded-lg"><i class="fa-solid fa-user-plus mr-2"></i>Add User</button>' },
                'field-reports': { t: 'Field Reports', s: 'Daily field updates.', a: '<button class="px-4 py-2 bg-brand text-dark font-bold rounded-lg"><i class="fa-solid fa-plus mr-2"></i>New Report</button>' },
                'weather': { t: 'Weather', s: 'Job site forecasts.', a: '' }
            };

            title.innerText = headers[viewName].t;
            sub.innerText = headers[viewName].s;
            actions.innerHTML = headers[viewName].a;

            // Trigger animations for progress bars if entering job costing
            if(viewName === 'job-costing') {
                setTimeout(() => {
                    document.querySelectorAll('.progress-bar').forEach(bar => {
                        bar.style.width = bar.getAttribute('data-width');
                    });
                }, 100);
            }
        }

        // ==========================================
        // 3. RENDER FUNCTIONS (MVP)
        // ==========================================
        function renderLineItems() {
            const tbody = document.getElementById('line-items-body');
            tbody.innerHTML = '';
            let sub = 0;
            lineItems.forEach((item, index) => {
                const total = item.qty * item.cost;
                sub += total;
                tbody.innerHTML += `
                    <tr class="border-b border-gray-100 hover:bg-gray-50">
                        <td class="p-3 text-gray-600">${item.category}</td>
                        <td class="p-3 text-gray-900">${item.desc}</td>
                        <td class="p-3 text-center">${item.qty}</td>
                        <td class="p-3 text-right">$${item.cost.toFixed(2)}</td>
                        <td class="p-3 text-right font-medium">$${total.toLocaleString()}</td>
                    </tr>`;
            });
            document.getElementById('subtotal-val').innerText = `$${sub.toLocaleString()}`;
            document.getElementById('grand-total-val').innerText = `$${(sub * 1.15).toLocaleString()}`; // 15% arbitrary markup for simplicity here
        }

        function renderClients() {
            const tbody = document.getElementById('clients-body');
            if (!tbody) return;
            tbody.innerHTML = '';
            clientsData.forEach((c, idx) => {
                const totalJobs = c.totalBids || 0;
                const totalRevenue = c.revenue || 0;
                tbody.innerHTML += `<tr onclick="showClientDetails(${idx})" class="border-b border-gray-100 hover:bg-gray-50 cursor-pointer">
                    <td class="px-6 py-4 font-bold text-gray-900">${c.company}</td>
                    <td class="px-6 py-4 text-gray-600">${c.contact}</td>
                    <td class="px-6 py-4 text-blue-600">${c.email}</td>
                    <td class="px-6 py-4 text-right text-gray-600">${totalJobs} jobs</td>
                    <td class="px-6 py-4 text-right font-bold text-green-600">$${totalRevenue.toLocaleString()}</td>
                </tr>`;
            });
        }
        
        function showClientDetails(idx) {
            const c = clientsData[idx];
            document.getElementById('details-title').innerText = c.company;
            document.getElementById('details-content').innerHTML = `
                <div class="grid grid-cols-2 gap-4">
                    <div><p class="text-sm text-gray-500">Contact</p><p class="font-medium">${c.contact}</p></div>
                    <div><p class="text-sm text-gray-500">Phone</p><p class="font-medium">${c.phone || 'N/A'}</p></div>
                    <div class="col-span-2"><p class="text-sm text-gray-500">Email</p><p class="font-medium text-blue-600">${c.email}</p></div>
                    <div class="col-span-2"><p class="text-sm text-gray-500">Address</p><p class="font-medium">${c.address || 'N/A'}</p></div>
                    <div><p class="text-sm text-gray-500">Total Jobs</p><p class="font-bold text-lg">${c.totalBids || 0}</p></div>
                    <div><p class="text-sm text-gray-500">Won</p><p class="font-bold text-lg text-green-600">${c.wins || 0}</p></div>
                    <div class="col-span-2"><p class="text-sm text-gray-500">Total Revenue</p><p class="font-bold text-xl text-green-600">$${(c.revenue || 0).toLocaleString()}</p></div>
                </div>`;
            document.getElementById('details-actions').innerHTML = `
                <button class="px-4 py-2 bg-blue-600 text-white rounded-lg text-sm"><i class="fa-solid fa-phone mr-2"></i>Call</button>
                <button class="px-4 py-2 bg-green-600 text-white rounded-lg text-sm"><i class="fa-solid fa-envelope mr-2"></i>Email</button>
                <button class="px-4 py-2 bg-brand text-dark font-bold rounded-lg text-sm"><i class="fa-solid fa-plus mr-2"></i>New Bid</button>`;
            document.getElementById('details-modal').classList.remove('hidden');
        }

        function renderRateCard() {
            const tbody = document.getElementById('rate-card-body');
            if (!tbody) return;
            tbody.innerHTML = '';
            rateCardData.forEach((r, idx) => {
                const unit = r.unit || 'each';
                tbody.innerHTML += `<tr onclick="showRateDetails(${idx})" class="border-b border-gray-100 hover:bg-gray-50 cursor-pointer">
                    <td class="px-6 py-4 font-bold text-gray-500">${r.cat}</td>
                    <td class="px-6 py-4 font-medium">${r.desc}</td>
                    <td class="px-6 py-4 text-right font-bold">$${r.cost.toFixed(2)}</td>
                    <td class="px-6 py-4 text-gray-500">/${unit}</td>
                </tr>`;
            });
        }
        
        function showRateDetails(idx) {
            const r = rateCardData[idx];
            document.getElementById('details-title').innerText = r.desc;
            document.getElementById('details-content').innerHTML = `
                <div class="grid grid-cols-2 gap-4">
                    <div><p class="text-sm text-gray-500">Category</p><p class="font-medium">${r.cat}</p></div>
                    <div><p class="text-sm text-gray-500">Unit</p><p class="font-medium">${r.unit || 'each'}</p></div>
                    <div class="col-span-2"><p class="text-sm text-gray-500">Rate</p><p class="font-bold text-2xl text-green-600">$${r.cost.toFixed(2)} <span class="text-base text-gray-500">per ${r.unit || 'unit'}</span></p></div>
                </div>`;
            document.getElementById('details-actions').innerHTML = `
                <button class="px-4 py-2 bg-brand text-dark font-bold rounded-lg text-sm"><i class="fa-solid fa-edit mr-2"></i>Edit Rate</button>
                <button class="px-4 py-2 bg-gray-600 text-white rounded-lg text-sm"><i class="fa-solid fa-copy mr-2"></i>Duplicate</button>`;
            document.getElementById('details-modal').classList.remove('hidden');
        }

        // ==========================================
        // 4. RENDER FUNCTIONS (Q2)
        // ==========================================
        
        function renderJobCosting() {
            const tbody = document.getElementById('job-costing-body');
            if (!tbody) return;
            let html = '';
            
            jobCostingData.forEach(j => {
                const percent = Math.min((j.actual / j.est) * 100, 100).toFixed(0);
                const isOver = j.actual > j.est;
                const barColor = isOver ? 'bg-red-500' : (percent > 85 ? 'bg-yellow-400' : 'bg-green-500');
                const statusBadge = isOver 
                    ? `<span class="px-2 py-1 bg-red-100 text-red-800 rounded text-xs font-bold">Over Budget</span>` 
                    : `<span class="px-2 py-1 bg-blue-100 text-blue-800 rounded text-xs font-bold">${j.status}</span>`;

                html += `
                    <tr class="border-b border-gray-100 hover:bg-gray-50 transition">
                        <td class="px-6 py-4">
                            <p class="font-bold text-gray-900">${j.project}</p>
                            <p class="text-xs text-gray-500">${j.client}</p>
                        </td>
                        <td class="px-6 py-4 text-right font-medium text-gray-600">$${j.est.toLocaleString()}</td>
                        <td class="px-6 py-4 text-right font-bold ${isOver ? 'text-red-600' : 'text-gray-900'}">$${j.actual.toLocaleString()}</td>
                        <td class="px-6 py-4">
                            <div class="flex items-center justify-between text-xs mb-1">
                                <span>${percent}%</span>
                                ${isOver ? '<span class="text-red-500"><i class="fa-solid fa-triangle-exclamation"></i></span>' : ''}
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2">
                                <div class="${barColor} h-2 rounded-full progress-bar" style="width: 0%;" data-width="${percent}%"></div>
                            </div>
                        </td>
                        <td class="px-6 py-4 text-center">${statusBadge}</td>
                    </tr>
                `;
            });
            tbody.innerHTML = html;
        }

        function renderEquipment() {
            const grid = document.getElementById('equipment-grid');
            if (!grid) return;
            let html = '';

            equipmentData.forEach((eq, idx) => {
                // Status styles
                let iconClass = 'fa-tractor';
                if(eq.type === 'Truck') iconClass = 'fa-truck';
                
                let dotColor = 'bg-green-500';
                if(eq.status === 'Idle') dotColor = 'bg-yellow-500';
                if(eq.status === 'Maintenance') dotColor = 'bg-red-500';

                html += `
                    <div class="bg-white rounded-xl border border-gray-200 shadow-sm p-5 hover:shadow-md transition cursor-pointer">
                        <div class="flex justify-between items-start mb-4">
                            <div class="flex gap-3 items-center">
                                <div class="w-10 h-10 rounded-lg bg-gray-100 text-gray-600 flex items-center justify-center text-lg">
                                    <i class="fa-solid ${iconClass}"></i>
                                </div>
                                <div>
                                    <h3 class="font-bold text-gray-900">${eq.name}</h3>
                                    <p class="text-xs text-gray-500 uppercase tracking-wider">${eq.id}</p>
                                </div>
                            </div>
                            <span class="flex items-center gap-1.5 text-xs font-medium px-2 py-1 bg-gray-50 rounded-md border border-gray-100">
                                <span class="w-2 h-2 rounded-full ${dotColor}"></span> ${eq.status}
                            </span>
                        </div>
                        
                        <div class="space-y-2 mb-4">
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-500"><i class="fa-solid fa-location-dot w-4 text-center mr-1"></i> Location</span>
                                <span class="font-medium text-gray-800">${eq.location}</span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-500"><i class="fa-regular fa-clock w-4 text-center mr-1"></i> Meter Hours</span>
                                <span class="font-medium text-gray-800">${eq.hours.toLocaleString()}</span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-500"><i class="fa-solid fa-wrench w-4 text-center mr-1"></i> Next Service</span>
                                <span class="${eq.status === 'Maintenance' ? 'text-red-500 font-bold' : 'font-medium text-gray-800'}">${eq.nextService}</span>
                            </div>
                        </div>
                        
                        <button class="w-full py-2 border border-gray-200 text-gray-600 text-sm font-medium rounded-lg hover:bg-gray-50 transition">
                            View Logs
                        </button>
                    </div>
                `;
            });
            grid.innerHTML = html;
        }

        function renderPortals() {
            const tbody = document.getElementById('portal-body');
            if (!tbody) return;
            let html = '';

            portalData.forEach(p => {
                html += `
                    <tr class="border-b border-gray-100 hover:bg-gray-50 transition">
                        <td class="px-6 py-4">
                            <p class="font-bold text-gray-900">${p.client}</p>
                        </td>
                        <td class="px-6 py-4 text-center font-medium text-gray-700">${p.active}</td>
                        <td class="px-6 py-4 text-center font-medium text-gray-700">${p.pending}</td>
                        <td class="px-6 py-4 text-sm text-gray-500">${p.lastLogin}</td>
                        <td class="px-6 py-4 text-right">
                            <a href="#" class="text-sm text-brand-dark hover:underline mr-4">Preview Portal</a>
                            <button class="px-3 py-1.5 bg-gray-100 text-gray-700 hover:bg-gray-200 rounded text-sm font-medium border border-gray-300 transition flex items-center gap-2 inline-flex">
                                <i class="fa-regular fa-copy"></i> Copy Link
                            </button>
                        </td>
                    </tr>
                `;
            });
            tbody.innerHTML = html;
        }

        // ==========================================
        // 5. CHART INITIALIZATION
        // ==========================================
        function initCharts() {
            new Chart(document.getElementById('revenueChart').getContext('2d'), {
                type: 'line',
                data: {
                    labels:['Sep', 'Oct', 'Nov', 'Dec', 'Jan', 'Feb'],
                    datasets:[{ label: 'Revenue', data:[150000, 180000, 120000, 210000, 250000, 290000], borderColor: '#eab308', backgroundColor: 'rgba(234, 179, 8, 0.1)', borderWidth: 3, tension: 0.3, fill: true }]
                },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: {display: false} } }
            });
            new Chart(document.getElementById('pipelineChart').getContext('2d'), {
                type: 'doughnut',
                data: {
                    labels:['Draft', 'Submitted', 'Negotiation'],
                    datasets:[{ data:[45000, 250000, 130000], backgroundColor:['#fef08a', '#3b82f6', '#ca8a04'], borderWidth: 0 }]
                },
                options: { responsive: true, maintainAspectRatio: false, cutout: '70%', plugins: { legend: { position: 'bottom' } } }
            });
        }

        // Bid data
// Bid statuses
let bidStatuses = {1: 'Draft', 2: 'Submitted', 3: 'Won', 4: 'Draft'};

const bidsData = {
    1: { name: 'Prattville Shopping Center', client: 'Apex Development', status: 'Submitted', items: [{ category: 'Mobilization', desc: 'Move in equipment', qty: 1, cost: 2500 },{ category: 'Excavation', desc: 'Building pad - 45000 sq ft', qty: 8500, cost: 4.50 },{ category: 'Backfill', desc: 'Utility trench backfill', qty: 1200, cost: 18.00 },{ category: 'Grading', desc: 'Final grade', qty: 45000, cost: 0.35 }]},
    2: { name: 'Wetumpka Sewer Main Extension', client: 'City of Wetumpka', status: 'Draft', items: [{ category: 'Mobilization', desc: 'Move in', qty: 1, cost: 3200 },{ category: 'Trenching', desc: '12" sewer main - 2400 LF', qty: 2400, cost: 28.00 },{ category: 'Pipe Install', desc: '12" PVC pipe', qty: 2400, cost: 45.00 },{ category: 'Restoration', desc: 'Asphalt patch', qty: 600, cost: 65.00 }]},
    3: { name: 'Montgomery Storage Facility', client: 'Southeast Storage LLC', status: 'Won', items: [{ category: 'Mobilization', desc: 'Move in', qty: 1, cost: 1800 },{ category: 'Excavation', desc: 'Building pads - 20 units', qty: 4200, cost: 5.25 },{ category: 'Utilities', desc: 'Water/sewer lines', qty: 20, cost: 450 }]},
    4: { name: 'Hillcrest Drive Residential', client: 'Lee Properties', status: 'Draft', items: [{ category: 'Mobilization', desc: 'Move in', qty: 1, cost: 1200 },{ category: 'Excavation', desc: 'Foundation dig', qty: 1800, cost: 6.50 },{ category: 'Backfill', desc: 'Foundation backfill', qty: 950, cost: 22.00 }]}
};

function loadBid(id) {
    const bidId = id;
    const bid = bidsData[id];
    if (!bid) return;
    
    // Update subtitle
    document.getElementById('page-subtitle').innerText = 'Editing: ' + bid.name;
    
    // Update status dropdown
    document.getElementById('bid-status').value = bid.status || 'Draft';
    
    // Update client info
    document.getElementById('bid-client').innerText = bid.client;
    const clientAddr = {1:'789 Commerce Way, Wetumpka',2:'100 City Hall Dr, Wetumpka',3:'8800 Atlanta Hwy, Montgomery',4:'200 Commerce St, Montgomery'};
    document.getElementById('bid-client-address').innerText = clientAddr[bidId] || '';
    document.getElementById('bid-date').innerText = new Date().toLocaleDateString();
    
    // Render line items
    let subtotal = 0;
    let html = '';
    bid.items.forEach((item, idx) => {
        const total = item.qty * item.cost;
        subtotal += total;
        html += '<tr class="border-b border-gray-100 hover:bg-gray-50" data-idx="'+idx+'">';
        html += '<td class="p-3">'+item.category+'</td>';
        html += '<td class="p-3">'+item.desc+'</td>';
        html += '<td class="p-3 text-center">'+item.qty+'</td>';
        html += '<td class="p-3 text-right">$'+item.cost.toFixed(2)+'</td>';
        html += '<td class="p-3 text-right font-medium">$'+total.toLocaleString()+'</td>';
        html += '</tr>';
    });
    document.getElementById('line-items-body').innerHTML = html;
    
    // Update totals
    const tax = subtotal * 0.0; // No tax on excavation
    document.getElementById('subtotal-val').innerText = '$'+subtotal.toLocaleString();
    document.getElementById('grand-total-val').innerText = '$'+(subtotal + tax).toLocaleString();
}

function updateBidStatus(status) {
    const bidId = document.getElementById('bid-selector').value;
    bidsData[bidId].status = status;
    // Show feedback
    const btn = document.querySelector('#bid-status');
    btn.classList.add('bg-green-100');
    setTimeout(() => btn.classList.remove('bg-green-100'), 500);
}

function emailBid() {
    const bidId = document.getElementById('bid-selector');
    const bidName = bidId.options[bidId.selectedIndex].text;
    alert('📧 Opening email client to send bid: ' + bidName + '\n\nTo: ' + (bidsData[bidId.value].client || 'client@email.com'));
    window.location.href = 'mailto:?subject=Bid Proposal - ' + encodeURIComponent(bidName) + '&body=Please find attached our bid proposal.';
}

function addLineItem() {
    const bidId = document.getElementById('bid-selector').value;
    bidsData[bidId].items.push({category: 'New Item', desc: 'Description', qty: 1, cost: 0});
    loadBid(bidId);
}


// Leads Data
const leadsData = [
    {id:1, company:'East Alabama Developmental', contact:'Mark Edwards', phone:'(334) 555-0201', email:'mark@eastaldev.com', source:'Referral', value:175000, status:'Hot', notes:'Interested in shopping center development'},
    {id:2, company:'City of Prattville', contact:'Public Works', phone:'(334) 555-0202', email:'publicworks@prattville.gov', source:'Bid List', value:85000, status:'Warm', notes:'Road improvement project'},
    {id:3, company:'Troy University', contact:'Facilities Manager', phone:'(334) 555-0203', email:'facilities@troy.edu', source:'Website', value:120000, status:'New', notes:'Campus expansion Phase 2'},
    {id:4, company:'Elmore County Schools', contact:'Superintendent', phone:'(334) 555-0204', email:'super@elmore.k12.al.us', source:'Cold Call', value:95000, status:'Warm', notes:'New elementary school site'},
    {id:5, company:'Millbrook Development Corp', contact:'Mike Johnson', phone:'(334) 555-0205', email:'mike@millbrookdev.com', source:'Referral', value:210000, status:'Hot', notes:'50-lot subdivision'}
];

// Invoices Data
const invoicesData = [
    {id:'INV-001', client:'Apex Development', amount:87500, status:'Sent', due:'2026-03-15', items:[{desc:'Prattville Shopping - Phase 1', amount:87500}]},
    {id:'INV-002', client:'Lee Properties', amount:142000, status:'Paid', due:'2026-02-28', paid:'2026-02-20', items:[{desc:'Hillcrest Drive - Excavation', amount:142000}]},
    {id:'INV-003', client:'City of Wetumpka', amount:45000, status:'Draft', due:'2026-04-01', items:[{desc:'Sewer Main - Design', amount:15000}, {desc:'Sewer Main - Installation', amount:30000}]},
    {id:'INV-004', client:'Southeast Storage', amount:67500, status:'Sent', due:'2026-03-10', items:[{desc:'Montgomery Storage - Site Prep', amount:67500}]},
    {id:'INV-005', client:'Prattville Medical', amount:28000, status:'Overdue', due:'2026-02-01', items:[{desc:'Parking Lot Expansion', amount:28000}]}
];

// 811 Tickets Data
const ticketsData = [
    {id:'811-2026-0156', location:'4500 Atlanta Hwy, Prattville, AL', status:'Active', expires:'2026-03-01', project:'Prattville Shopping Center', utility:'Multiple'},
    {id:'811-2026-0157', location:'2200 River Rd, Wetumpka, AL', status:'Active', expires:'2026-03-05', project:'Wetumpka Sewer Main', utility:'Water, Sewer'},
    {id:'811-2026-0148', location:'8900 Commerce Way, Wetumpka, AL', status:'Complete', expires:'2026-02-15', project:'Completed Site Work', utility:'Gas'},
    {id:'811-2026-0145', location:'1500 Hillcrest Dr, Montgomery, AL', status:'Active', expires:'2026-03-10', project:'Hillcrest Residential', utility:'Electric'},
    {id:'811-2026-0140', location:'3200 Troy Hwy, Montgomery, AL', status:'Pending', expires:'2026-03-15', project:'Troy Highway Development', utility:'Multiple'}
];

// Change Orders Data
const changeOrdersData = [
    {id:1, project:'Prattville Shopping Center', desc:'Additional grading - east lot', amount:8500, status:'Pending', reason:'Owner requested additional work', date:'2026-02-20'},
    {id:2, project:'Wetumpka Sewer Main', desc:'Added drainage pipe', amount:3200, status:'Approved', reason:'Unforeseen condition', date:'2026-02-18'},
    {id:3, project:'Montgomery Storage Facility', desc:'Rock removal - bedrock', amount:12500, status:'Pending', reason:'Hard rock encountered', date:'2026-02-22'},
    {id:4, project:'Hillcrest Drive Residential', desc:'Added driveway culvert', amount:1800, status:'Approved', reason:'Code requirement', date:'2026-02-15'}
];

// Subcontractors Data
const subsData = [
    {id:1, company:'Alabama Concrete LLC', trade:'Concrete', contact:'Mike Jones', phone:'(334) 555-0301', email:'mike@alaconcrete.com', status:'Available', insurance:'Valid - Dec 2026', rating:4.5},
    {id:2, company:'Gulf Coast Utilities', trade:'Electrical', contact:'Sam Wilson', phone:'(334) 555-0302', email:'sam@gulfcoastutil.com', status:'Busy', insurance:'Valid - Aug 2026', rating:4.2},
    {id:3, company:'Delta Plumbing Inc', trade:'Plumbing', contact:'John Delta', phone:'(334) 555-0303', email:'john@deltaplumbing.com', status:'Available', insurance:'Valid - Oct 2026', rating:4.7},
    {id:4, company:'Southeastern Hauling', trade:'Hauling', contact:'Tony Mack', phone:'(334) 555-0304', email:'tony@sehauling.com', status:'Available', insurance:'Valid - Nov 2026', rating:4.0},
    {id:5, company:'Alabama Grading Services', trade:'Grading', contact:'Rick Brown', phone:'(334) 555-0305', email:'rick@algrading.com', status:'Busy', insurance:'Valid - Sep 2026', rating:4.8}
];

// Field Reports Data
const fieldReportsData = [
    {id:1, date:'2026-02-25', project:'Prattville Shopping Center', crew:6, hours:48, weather:'Sunny 72F', notes:'Completed grading lots 1-5. Started utility trenching.', equipment:['CAT 320','CAT 950','2 Dump Trucks'], materials:['CR-6: 150 tons']},
    {id:2, date:'2026-02-24', project:'Wetumpka Sewer Main', crew:4, hours:32, weather:'Rain 55F', notes:'Weather delay. Crew on standby.', equipment:['CAT 336','Water Truck'], materials:[]},
    {id:3, date:'2026-02-23', project:'Hillcrest Drive', crew:3, hours:24, weather:'Cloudy 65F', notes:'Completed foundation excavations for lots 8-12.', equipment:['CAT 320','Skid Steer'], materials:['Backfill: 80 yards']},
    {id:4, date:'2026-02-22', project:'Montgomery Storage', crew:5, hours:40, weather:'Sunny 68F', notes:'Final grade complete. Utilities in progress.', equipment:['CAT D6','CAT 140M','3 Trucks'], materials:['#57 Stone: 200 tons']},
    {id:5, date:'2026-02-21', project:'Prattville Shopping Center', crew:4, hours:36, weather:'Windy 60F', notes:'Started storm drain installation.', equipment:['CAT 320','Backhoe'], materials:['Storm pipe: 400 LF']}
];

// Render functions
function renderLeads() {
    const tbody = document.getElementById('leads-body');
    if (!tbody) return;
    let html = '';
    tbody.innerHTML = '';
    leadsData.forEach((l, idx) => {
        const statusClass = l.status === 'Hot' ? 'bg-red-100 text-red-800' : l.status === 'Warm' ? 'bg-yellow-100 text-yellow-800' : 'bg-blue-100 text-blue-800';
        html += '<tr class="border-b border-gray-100 hover:bg-gray-50"><td class="px-6 py-4 font-bold">'+l.company+'</td><td class="px-6 py-4">'+l.contact+'</td><td class="px-6 py-4">'+l.source+'</td><td class="px-6 py-4 text-right">$'+l.value.toLocaleString()+'</td><td class="px-6 py-4"><span class="px-2 py-1 rounded text-xs font-bold '+statusClass+'">'+l.status+'</span></td></tr>';
    });
    document.getElementById('leads-body').innerHTML = html;
}

function renderInvoices() {
    const tbody = document.getElementById('invoices-body');
    if (!tbody) return;
    let html = '';
    tbody.innerHTML = '';
    invoicesData.forEach((i, idx) => {
        const statusClass = i.status === 'Paid' ? 'bg-green-100 text-green-800' : i.status === 'Sent' ? 'bg-blue-100 text-blue-800' : 'bg-gray-100 text-gray-800';
        html += '<tr class="border-b border-gray-100 hover:bg-gray-50"><td class="px-6 py-4 font-mono">'+i.id+'</td><td class="px-6 py-4 font-bold">'+i.client+'</td><td class="px-6 py-4 text-right">$'+i.amount.toLocaleString()+'</td><td class="px-6 py-4"><span class="px-2 py-1 rounded text-xs font-bold '+statusClass+'">'+i.status+'</span></td><td class="px-6 py-4">'+i.due+'</td></tr>';
    });
    document.getElementById('invoices-body').innerHTML = html;
}

function renderTickets() {
    const tbody = document.getElementById('tickets-body');
    if (!tbody) return;
    let html = '';
    tbody.innerHTML = '';
    ticketsData.forEach((t, idx) => {
        const statusClass = t.status === 'Active' ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800';
        html += '<tr class="border-b border-gray-100 hover:bg-gray-50"><td class="px-6 py-4 font-mono">'+t.id+'</td><td class="px-6 py-4">'+t.location+'</td><td class="px-6 py-4"><span class="px-2 py-1 rounded text-xs font-bold '+statusClass+'">'+t.status+'</span></td><td class="px-6 py-4">'+t.expires+'</td></tr>';
    });
    document.getElementById('tickets-body').innerHTML = html;
}

function renderChangeOrders() {
    const tbody = document.getElementById('co-body');
    if (!tbody) return;
    let html = '';
    tbody.innerHTML = '';
    changeOrdersData.forEach((c, idx) => {
        const statusClass = c.status === 'Approved' ? 'bg-green-100 text-green-800' : c.status === 'Pending' ? 'bg-yellow-100 text-yellow-800' : 'bg-red-100 text-red-800';
        html += '<tr class="border-b border-gray-100 hover:bg-gray-50"><td class="px-6 py-4 font-bold">'+c.project+'</td><td class="px-6 py-4">'+c.desc+'</td><td class="px-6 py-4 text-right">$'+c.amount.toLocaleString()+'</td><td class="px-6 py-4"><span class="px-2 py-1 rounded text-xs font-bold '+statusClass+'">'+c.status+'</span></td></tr>';
    });
    document.getElementById('co-body').innerHTML = html;
}

function renderSubs() {
    const tbody = document.getElementById('subs-body');
    if (!tbody) return;
    let html = '';
    tbody.innerHTML = '';
    subsData.forEach((s, idx) => {
        const statusClass = s.status === 'Available' ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800';
        html += '<tr class="border-b border-gray-100 hover:bg-gray-50"><td class="px-6 py-4 font-bold">'+s.company+'</td><td class="px-6 py-4">'+s.trade+'</td><td class="px-6 py-4">'+s.contact+'</td><td class="px-6 py-4"><span class="px-2 py-1 rounded text-xs font-bold '+statusClass+'">'+s.status+'</span></td></tr>';
    });
    document.getElementById('subs-body').innerHTML = html;
}

function renderFieldReports() {
    const tbody = document.getElementById('fr-body');
    if (!tbody) return;
    let html = '';
    tbody.innerHTML = '';
    fieldReportsData.forEach((f, idx) => {
        html += '<tr class="border-b border-gray-100 hover:bg-gray-50"><td class="px-6 py-4">'+f.date+'</td><td class="px-6 py-4 font-bold">'+f.project+'</td><td class="px-6 py-4">'+f.crew+'</td><td class="px-6 py-4">'+f.hours+'</td><td class="px-6 py-4 text-sm">'+f.notes+'</td></tr>';
    });
    document.getElementById('fr-body').innerHTML = html;
}


        // Details Modal Functions
        function closeDetails() {
            document.getElementById('details-modal').classList.add('hidden');
        }
        
        function showLeadDetails(idx) {
            const lead = leadsData[idx];
            const statusClass = lead.status === 'Hot' ? 'bg-red-100 text-red-800' : lead.status === 'Warm' ? 'bg-yellow-100 text-yellow-800' : 'bg-blue-100 text-blue-800';
            document.getElementById('details-title').innerText = lead.company;
            document.getElementById('details-content').innerHTML = `
                <div class="grid grid-cols-2 gap-4">
                    <div><p class="text-sm text-gray-500">Contact</p><p class="font-medium">${lead.contact || 'N/A'}</p></div>
                    <div><p class="text-sm text-gray-500">Source</p><p class="font-medium">${lead.source}</p></div>
                    <div><p class="text-sm text-gray-500">Value</p><p class="font-medium text-green-600">$${lead.value.toLocaleString()}</p></div>
                    <div><p class="text-sm text-gray-500">Status</p><span class="px-2 py-1 rounded text-xs font-bold ${statusClass}">${lead.status}</span></div>
                    <div class="col-span-2"><p class="text-sm text-gray-500">Notes</p><p class="font-medium">Interested in commercial development. Follow up next week.</p></div>
                </div>`;
            document.getElementById('details-actions').innerHTML = `
                <button class="px-4 py-2 bg-blue-600 text-white rounded-lg text-sm"><i class="fa-solid fa-phone mr-2"></i>Call</button>
                <button class="px-4 py-2 bg-green-600 text-white rounded-lg text-sm"><i class="fa-solid fa-envelope mr-2"></i>Email</button>
                <button class="px-4 py-2 bg-brand text-dark font-bold rounded-lg text-sm"><i class="fa-solid fa-file-signature mr-2"></i>Convert to Bid</button>`;
            document.getElementById('details-modal').classList.remove('hidden');
        }
        
        function showInvoiceDetails(idx) {
            const inv = invoicesData[idx];
            const statusClass = inv.status === 'Paid' ? 'bg-green-100 text-green-800' : inv.status === 'Sent' ? 'bg-blue-100 text-blue-800' : 'bg-gray-100 text-gray-800';
            document.getElementById('details-title').innerText = 'Invoice ' + inv.id;
            document.getElementById('details-content').innerHTML = `
                <div class="space-y-4">
                    <div class="grid grid-cols-2 gap-4">
                        <div><p class="text-sm text-gray-500">Client</p><p class="font-medium">${inv.client}</p></div>
                        <div><p class="text-sm text-gray-500">Status</p><span class="px-2 py-1 rounded text-xs font-bold ${statusClass}">${inv.status}</span></div>
                        <div><p class="text-sm text-gray-500">Amount</p><p class="font-medium text-green-600 text-xl">$${inv.amount.toLocaleString()}</p></div>
                        <div><p class="text-sm text-gray-500">Due Date</p><p class="font-medium">${inv.due}</p></div>
                    </div>
                    <div class="border-t pt-4"><h4 class="font-bold mb-2">Line Items</h4>
                        <div class="table-scroll"><table class="w-full text-sm"><thead class="bg-gray-50"><tr><th class="p-2 text-left">Description</th><th class="p-2 text-right">Amount</th></tr></thead>
                        <tbody><tr><td class="p-2">Excavation - Phase 1</td><td class="p-2 text-right">$${(inv.amount * 0.6).toFixed(0)}</td></tr>
                        <tr><td class="p-2">Backfill</td><td class="p-2 text-right">$${(inv.amount * 0.3).toFixed(0)}</td></tr>
                        <tr><td class="p-2">Site Prep</td><td class="p-2 text-right">$${(inv.amount * 0.1).toFixed(0)}</td></tr></tbody></table>
                    </div>
                </div>`;
            document.getElementById('details-actions').innerHTML = inv.status === 'Paid' ? 
                `<button class="px-4 py-2 bg-gray-600 text-white rounded-lg text-sm" disabled>Already Paid</button>` :
                `<button class="px-4 py-2 bg-green-600 text-white rounded-lg text-sm"><i class="fa-solid fa-check mr-2"></i>Mark as Paid</button>
                 <button class="px-4 py-2 bg-blue-600 text-white rounded-lg text-sm"><i class="fa-solid fa-envelope mr-2"></i>Send Reminder</button>
                 <button class="px-4 py-2 bg-gray-800 text-white rounded-lg text-sm"><i class="fa-solid fa-print mr-2"></i>Print</button>`;
            document.getElementById('details-modal').classList.remove('hidden');
        }
        
        function showTicketDetails(idx) {
            const t = ticketsData[idx];
            const statusClass = t.status === 'Active' ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800';
            document.getElementById('details-title').innerText = 'Ticket ' + t.id;
            document.getElementById('details-content').innerHTML = `
                <div class="grid grid-cols-2 gap-4">
                    <div><p class="text-sm text-gray-500">Location</p><p class="font-medium">${t.location}</p></div>
                    <div><p class="text-sm text-gray-500">Status</p><span class="px-2 py-1 rounded text-xs font-bold ${statusClass}">${t.status}</span></div>
                    <div><p class="text-sm text-gray-500">Expires</p><p class="font-medium">${t.expires}</p></div>
                    <div><p class="text-sm text-gray-500">Ticket Type</p><p class="font-medium">Standard Utility</p></div>
                    <div class="col-span-2"><p class="text-sm text-gray-500">Map</p><a href="https://maps.google.com/?q=${encodeURIComponent(t.location)}" target="_blank" class="text-blue-600 hover:underline">View on Google Maps</a></div>
                </div>`;
            document.getElementById('details-actions').innerHTML = `<button class="px-4 py-2 bg-gray-800 text-white rounded-lg text-sm"><i class="fa-solid fa-print mr-2"></i>Print Ticket</button>`;
            document.getElementById('details-modal').classList.remove('hidden');
        }
        
        function showSubDetails(idx) {
            const s = subsData[idx];
            const statusClass = s.status === 'Available' ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800';
            document.getElementById('details-title').innerText = s.company;
            document.getElementById('details-content').innerHTML = `
                <div class="grid grid-cols-2 gap-4">
                    <div><p class="text-sm text-gray-500">Trade</p><p class="font-medium">${s.trade}</p></div>
                    <div><p class="text-sm text-gray-500">Status</p><span class="px-2 py-1 rounded text-xs font-bold ${statusClass}">${s.status}</span></div>
                    <div><p class="text-sm text-gray-500">Contact</p><p class="font-medium">${s.contact}</p></div>
                    <div><p class="text-sm text-gray-500">Phone</p><p class="font-medium">(334) 555-01${Math.floor(Math.random()*99)}</p></div>
                    <div class="col-span-2"><p class="text-sm text-gray-500">Insurance</p><p class="font-medium text-green-600">✅ $2M Liability - Valid thru Dec 2026</p></div>
                    <div class="col-span-2"><p class="text-sm text-gray-500">Rating</p><p class="text-yellow-500">★★★★☆ 4.2/5.0 (12 jobs)</p></div>
                </div>`;
            document.getElementById('details-actions').innerHTML = `<button class="px-4 py-2 bg-blue-600 text-white rounded-lg text-sm"><i class="fa-solid fa-phone mr-2"></i>Call</button>
                <button class="px-4 py-2 bg-green-600 text-white rounded-lg text-sm"><i class="fa-solid fa-envelope mr-2"></i>Email</button>
                <button class="px-4 py-2 bg-brand text-dark font-bold rounded-lg text-sm">Request Quote</button>`;
            document.getElementById('details-modal').classList.remove('hidden');
        }
        
        function showCODetails(idx) {
            const co = changeOrdersData[idx];
            const statusClass = co.status === 'Approved' ? 'bg-green-100 text-green-800' : co.status === 'Pending' ? 'bg-yellow-100 text-yellow-800' : 'bg-red-100 text-red-800';
            document.getElementById('details-title').innerText = 'Change Order - ' + co.project;
            document.getElementById('details-content').innerHTML = `
                <div class="space-y-4">
                    <div class="grid grid-cols-2 gap-4">
                        <div><p class="text-sm text-gray-500">Amount</p><p class="font-medium text-green-600 text-xl">$${co.amount.toLocaleString()}</p></div>
                        <div><p class="text-sm text-gray-500">Status</p><span class="px-2 py-1 rounded text-xs font-bold ${statusClass}">${co.status}</span></div>
                    </div>
                    <div><p class="text-sm text-gray-500">Description</p><p class="font-medium">${co.desc}</p></div>
                    <div><p class="text-sm text-gray-500">Reason</p><p class="font-medium">Owner requested additional work</p></div>
                    <div><p class="text-sm text-gray-500">Created</p><p class="font-medium">Feb 20, 2026</p></div>
                </div>`;
            document.getElementById('details-actions').innerHTML = co.status === 'Pending' ? 
                `<button class="px-4 py-2 bg-green-600 text-white rounded-lg text-sm"><i class="fa-solid fa-check mr-2"></i>Approve</button>
                 <button class="px-4 py-2 bg-red-600 text-white rounded-lg text-sm"><i class="fa-solid fa-xmark mr-2"></i>Reject</button>` :
                `<button class="px-4 py-2 bg-gray-600 text-white rounded-lg text-sm" disabled>${co.status}</button>`;
            document.getElementById('details-modal').classList.remove('hidden');
        }
        
        function showFRDetails(idx) {
            const fr = fieldReportsData[idx];
            document.getElementById('details-title').innerText = 'Field Report - ' + fr.project;
            document.getElementById('details-content').innerHTML = `
                <div class="space-y-4">
                    <div class="grid grid-cols-2 gap-4">
                        <div><p class="text-sm text-gray-500">Date</p><p class="font-medium">${fr.date}</p></div>
                        <div><p class="text-sm text-gray-500">Project</p><p class="font-medium">${fr.project}</p></div>
                        <div><p class="text-sm text-gray-500">Crew Size</p><p class="font-medium">${fr.crew} workers</p></div>
                        <div><p class="text-sm text-gray-500">Total Hours</p><p class="font-medium">${fr.hours} hrs</p></div>
                    </div>
                    <div><p class="text-sm text-gray-500">Notes</p><p class="font-medium bg-gray-50 p-3 rounded">${fr.notes}</p></div>
                    <div><p class="text-sm text-gray-500">Equipment Used</p><p class="font-medium">CAT 320 Excavator, Ford F-350</p></div>
                    <div><p class="text-sm text-gray-500">Materials</p><p class="font-medium">12 tons crush run, 8 tons #57 stone</p></div>
                    <div><p class="text-sm text-gray-500">Weather</p><p class="font-medium">Sunny, 68°F</p></div>
                </div>`;
            document.getElementById('details-actions').innerHTML = `<button class="px-4 py-2 bg-gray-800 text-white rounded-lg text-sm"><i class="fa-solid fa-print mr-2"></i>Print Report</button>`;
            document.getElementById('details-modal').classList.remove('hidden');
        }


        function toggleSidebar() {
            document.querySelector('.sidebar').classList.toggle('active');
            document.getElementById('sidebar-overlay').classList.toggle('active');
        }

// Initialize Everything on Load
        window.onload = () => {
            loadBid(1);
            renderLineItems();
            renderClients();
            renderRateCard();
            renderJobCosting();
            renderEquipment();
            renderPortals();
            renderLeads();
            renderInvoices();
            renderTickets();
            renderChangeOrders();
            renderSubs();
            renderFieldReports();
            initCharts();
            // Load initial bid
            setTimeout(() => loadBid(1), 100);
        };
    </script>

    <!-- Details Modal -->
    <div id="details-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
            <div class="p-4 border-b border-gray-200 flex justify-between items-center sticky top-0 bg-white">
                <h2 id="details-title" class="text-lg font-bold"></h2>
                <button onclick="closeDetails()" class="text-2xl text-gray-400 hover:text-gray-600">&times;</button>
            </div>
            <div id="details-content" class="p-4"></div>
            <div id="details-actions" class="p-4 border-t border-gray-200 flex gap-2"></div>
        </div>
    </div>

</body>
</html>