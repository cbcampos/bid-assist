<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BidAssist - Excavation Estimating</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        brand: {
                            light: '#fef08a', 
                            DEFAULT: '#eab308', 
                            dark: '#ca8a04', 
                        },
                        dark: '#111827',
                    }
                }
            }
        }
    </script>
    <style>
        /* Print Styles for PDF Export */
        @media print {
            body { background-color: white; }
            .no-print { display: none !important; }
            .print-only { display: block !important; }
            .main-content { margin-left: 0 !important; width: 100% !important; padding: 0 !important; }
            .shadow-sm, .shadow-md { box-shadow: none !important; }
            .border { border: 1px solid #ddd !important; }
            .no-print-border { border: none !important; appearance: none !important; }
        }
        .print-only { display: none; }
        
        /* Smooth transitions */
        .fade-in { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Progress Bar Animation */
        .progress-bar { transition: width 1s ease-in-out; }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 font-sans">

    <!-- Sidebar (Hidden on Print) -->
    <aside class="no-print fixed inset-y-0 left-0 bg-dark text-white w-64 flex flex-col transition-transform z-20">
        <div class="flex items-center justify-center h-16 bg-black border-b border-gray-800">
            <i class="fa-solid fa-truck-excavator text-brand text-2xl mr-2"></i>
            <span class="text-xl font-bold tracking-wider">BidAssist</span>
        </div>
        
        <div class="overflow-y-auto flex-1 pb-6">
            <nav class="px-4 py-4 space-y-1">
                <p class="px-4 text-xs font-bold text-gray-500 uppercase tracking-wider mb-2 mt-4">Estimating</p>
                <a href="#" id="nav-dashboard" onclick="switchView('dashboard')" class="flex items-center gap-3 px-4 py-3 bg-gray-800 text-brand rounded-lg transition">
                    <i class="fa-solid fa-chart-pie w-5 text-center"></i> Dashboard
                </a>
                <a href="#" id="nav-bid-editor" onclick="switchView('bid-editor')" class="flex items-center gap-3 px-4 py-3 text-gray-400 hover:text-white hover:bg-gray-800 rounded-lg transition">
                    <i class="fa-solid fa-file-signature w-5 text-center"></i> Active Bids
                </a>
                <a href="#" id="nav-rate-card" onclick="switchView('rate-card')" class="flex items-center gap-3 px-4 py-3 text-gray-400 hover:text-white hover:bg-gray-800 rounded-lg transition">
                    <i class="fa-solid fa-tags w-5 text-center"></i> Rate Card
                </a>

                <p class="px-4 text-xs font-bold text-gray-500 uppercase tracking-wider mb-2 mt-6">Operations (Q2)</p>
                <a href="#" id="nav-job-costing" onclick="switchView('job-costing')" class="flex items-center gap-3 px-4 py-3 text-gray-400 hover:text-white hover:bg-gray-800 rounded-lg transition">
                    <i class="fa-solid fa-calculator w-5 text-center"></i> Job Costing
                </a>
                <a href="#" id="nav-equipment" onclick="switchView('equipment')" class="flex items-center gap-3 px-4 py-3 text-gray-400 hover:text-white hover:bg-gray-800 rounded-lg transition">
                    <i class="fa-solid fa-tractor w-5 text-center"></i> Equipment Fleet
                </a>

                <p class="px-4 text-xs font-bold text-gray-500 uppercase tracking-wider mb-2 mt-6">CRM</p>
                <a href="#" id="nav-clients" onclick="switchView('clients')" class="flex items-center gap-3 px-4 py-3 text-gray-400 hover:text-white hover:bg-gray-800 rounded-lg transition">
                    <i class="fa-solid fa-users w-5 text-center"></i> Clients
                </a>
                <a href="#" id="nav-portal" onclick="switchView('portal')" class="flex items-center gap-3 px-4 py-3 text-gray-400 hover:text-white hover:bg-gray-800 rounded-lg transition">
                    <i class="fa-solid fa-laptop-house w-5 text-center"></i> Client Portals
                </a>
            </nav>
        </div>

        <div class="p-4 border-t border-gray-800 mt-auto">
            <div class="flex items-center gap-3">
                <div class="w-8 h-8 rounded-full bg-brand text-dark flex items-center justify-center font-bold">R</div>
                <div>
                    <p class="text-sm font-medium">Ralph</p>
                    <p class="text-xs text-gray-400">5B Contracting</p>
                </div>
            </div>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content ml-64 p-8 min-h-screen">
        
        <!-- DYNAMIC HEADER -->
        <header class="no-print flex justify-between items-center mb-8">
            <div>
                <h1 id="page-title" class="text-2xl font-bold text-gray-900">Dashboard Overview</h1>
                <p id="page-subtitle" class="text-gray-500 text-sm">Welcome back. Here's your pipeline status.</p>
            </div>
            <div class="flex gap-3">
                <button class="px-4 py-2 bg-white border border-gray-300 rounded-lg text-sm font-medium hover:bg-gray-50 shadow-sm transition">
                    <i class="fa-regular fa-bell"></i>
                </button>
                <div id="header-actions">
                    <button onclick="switchView('bid-editor')" class="px-4 py-2 bg-brand text-dark font-bold rounded-lg hover:bg-brand-dark shadow-sm transition flex items-center gap-2">
                        <i class="fa-solid fa-plus"></i> New Bid
                    </button>
                </div>
            </div>
        </header>

        <!-- ========================================== -->
        <!-- VIEW: DASHBOARD -->
        <!-- ========================================== -->
        <div id="view-dashboard" class="fade-in block">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                <div class="bg-white p-6 rounded-xl border border-gray-200 shadow-sm border-t-4 border-t-blue-500">
                    <h3 class="text-gray-500 text-sm font-medium">Active Bids</h3>
                    <p class="text-3xl font-bold mt-2">12</p>
                    <p class="text-sm text-green-600 mt-2"><i class="fa-solid fa-arrow-trend-up"></i> +3 this week</p>
                </div>
                <div class="bg-white p-6 rounded-xl border border-gray-200 shadow-sm border-t-4 border-t-brand">
                    <h3 class="text-gray-500 text-sm font-medium">Total Pipeline</h3>
                    <p class="text-3xl font-bold mt-2">$425,000</p>
                    <p class="text-sm text-gray-500 mt-2">Across 12 pending projects</p>
                </div>
                <div class="bg-white p-6 rounded-xl border border-gray-200 shadow-sm border-t-4 border-t-green-500">
                    <h3 class="text-gray-500 text-sm font-medium">Win Rate</h3>
                    <p class="text-3xl font-bold mt-2">42%</p>
                    <p class="text-sm text-green-600 mt-2"><i class="fa-solid fa-arrow-trend-up"></i> Target: >40%</p>
                </div>
                <div class="bg-white p-6 rounded-xl border border-gray-200 shadow-sm border-t-4 border-t-purple-500">
                    <h3 class="text-gray-500 text-sm font-medium">YTD Revenue</h3>
                    <p class="text-3xl font-bold mt-2">$1.2M</p>
                    <p class="text-sm text-gray-500 mt-2">Closed Won</p>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                <div class="bg-white p-6 rounded-xl border border-gray-200 shadow-sm">
                    <h3 class="font-bold text-gray-800 mb-4">Revenue Trends</h3>
                    <canvas id="revenueChart" style="max-height: 300px;"></canvas>
                </div>
                <div class="bg-white p-6 rounded-xl border border-gray-200 shadow-sm">
                    <h3 class="font-bold text-gray-800 mb-4">Pipeline by Status</h3>
                    <div class="flex justify-center">
                        <canvas id="pipelineChart" style="max-height: 300px;"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- ========================================== -->
        <!-- VIEW: JOB COSTING (Q2) -->
        <!-- ========================================== -->
        <div id="view-job-costing" class="fade-in hidden">
            <!-- Job Costing KPIs -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="bg-white p-6 rounded-xl border border-gray-200 shadow-sm">
                    <div class="flex items-center gap-4">
                        <div class="p-3 bg-blue-100 text-blue-600 rounded-lg"><i class="fa-solid fa-helmet-safety text-xl"></i></div>
                        <div>
                            <h3 class="text-gray-500 text-sm font-medium">Active Jobs</h3>
                            <p class="text-2xl font-bold">4</p>
                        </div>
                    </div>
                </div>
                <div class="bg-white p-6 rounded-xl border border-gray-200 shadow-sm">
                    <div class="flex items-center gap-4">
                        <div class="p-3 bg-red-100 text-red-600 rounded-lg"><i class="fa-solid fa-chart-line text-xl"></i></div>
                        <div>
                            <h3 class="text-gray-500 text-sm font-medium">Avg Profit Margin (Actual)</h3>
                            <p class="text-2xl font-bold">12.4% <span class="text-sm text-red-500 font-normal">(-2.6% vs Est)</span></p>
                        </div>
                    </div>
                </div>
                <div class="bg-white p-6 rounded-xl border border-gray-200 shadow-sm">
                    <div class="flex items-center gap-4">
                        <div class="p-3 bg-green-100 text-green-600 rounded-lg"><i class="fa-solid fa-file-invoice-dollar text-xl"></i></div>
                        <div>
                            <h3 class="text-gray-500 text-sm font-medium">Total WIP Billed</h3>
                            <p class="text-2xl font-bold">$185,400</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Active Jobs Table -->
            <div class="bg-white rounded-xl border border-gray-200 shadow-sm overflow-hidden">
                <table class="w-full text-left border-collapse">
                    <thead>
                        <tr class="bg-gray-50 text-gray-500 text-xs uppercase tracking-wider border-b border-gray-200">
                            <th class="px-6 py-4 font-bold">Project / Client</th>
                            <th class="px-6 py-4 font-bold text-right">Estimated Cost</th>
                            <th class="px-6 py-4 font-bold text-right">Actual Cost</th>
                            <th class="px-6 py-4 font-bold w-1/4">Budget Used</th>
                            <th class="px-6 py-4 font-bold text-center">Status</th>
                        </tr>
                    </thead>
                    <tbody id="job-costing-body" class="text-sm">
                        <!-- Populated by JS -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- ========================================== -->
        <!-- VIEW: EQUIPMENT FLEET (Q2) -->
        <!-- ========================================== -->
        <div id="view-equipment" class="fade-in hidden">
            <!-- Filter Bar -->
            <div class="flex justify-between items-center mb-6">
                <div class="flex gap-4">
                    <select class="border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-brand focus:border-brand bg-white shadow-sm">
                        <option>All Equipment</option>
                        <option>Excavators</option>
                        <option>Dozers</option>
                        <option>Loaders</option>
                        <option>Trucks</option>
                    </select>
                    <select class="border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-brand focus:border-brand bg-white shadow-sm">
                        <option>All Statuses</option>
                        <option>Active</option>
                        <option>Maintenance</option>
                        <option>Idle</option>
                    </select>
                </div>
            </div>

            <!-- Equipment Grid -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="equipment-grid">
                <!-- Populated by JS -->
            </div>
        </div>

        <!-- ========================================== -->
        <!-- VIEW: CLIENT PORTAL (Q2) -->
        <!-- ========================================== -->
        <div id="view-portal" class="fade-in hidden">
            <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-8 flex items-start gap-4 text-blue-800">
                <i class="fa-solid fa-circle-info mt-1"></i>
                <div>
                    <h3 class="font-bold">Client Portals are Active</h3>
                    <p class="text-sm mt-1">Share these secure links with your clients so they can view, approve, and track their bids in real-time. Changes made in the Bid Editor will instantly reflect on their portal.</p>
                </div>
            </div>

            <div class="bg-white rounded-xl border border-gray-200 shadow-sm overflow-hidden">
                <table class="w-full text-left border-collapse">
                    <thead>
                        <tr class="bg-gray-50 text-gray-500 text-xs uppercase tracking-wider border-b border-gray-200">
                            <th class="px-6 py-4 font-bold">Client Company</th>
                            <th class="px-6 py-4 font-bold text-center">Active Jobs</th>
                            <th class="px-6 py-4 font-bold text-center">Pending Bids</th>
                            <th class="px-6 py-4 font-bold">Last Client Login</th>
                            <th class="px-6 py-4 font-bold text-right">Portal Link</th>
                        </tr>
                    </thead>
                    <tbody id="portal-body" class="text-sm">
                        <!-- Populated by JS -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- ========================================== -->
        <!-- VIEW: BID EDITOR (MVP) -->
        <!-- ========================================== -->
        <div id="view-bid-editor" class="fade-in hidden">
            <div class="no-print flex justify-between items-center bg-white p-4 rounded-xl border border-gray-200 shadow-sm mb-6">
                <div class="flex items-center gap-4 text-sm">
                    <span class="text-gray-500">Select Bid:</span>
                <select id="bid-selector" onchange="loadBid(this.value)" class="border-gray-300 rounded-md shadow-sm focus:ring-brand focus:border-brand text-sm font-medium">
                    <option value="1">Highland Subdivision Phase 2</option>
                    <option value="2">Eastdale Commons</option>
                    <option value="3">VA Hospital</option>
                    <option value="4">Downtown Mixed-Use</option>
                </select>
                <span class="text-gray-500 ml-4">Status:</span>
                    <select class="border-gray-300 rounded-md shadow-sm focus:ring-brand focus:border-brand text-sm font-medium">
                        <option>Draft</option>
                        <option>Submitted</option>
                        <option>Won</option>
                        <option>Lost</option>
                    </select>
                </div>
                <div class="flex gap-2">
                    <button onclick="window.print()" class="px-4 py-2 bg-gray-800 text-white rounded-lg text-sm font-medium hover:bg-gray-900 transition shadow-sm">
                        <i class="fa-regular fa-file-pdf mr-1"></i> Export PDF
                    </button>
                    <button class="px-4 py-2 bg-brand text-dark font-bold rounded-lg text-sm hover:bg-brand-dark transition shadow-sm">
                        <i class="fa-regular fa-paper-plane mr-1"></i> Email Bid
                    </button>
                </div>
            </div>

            <div id="printable-bid" class="bg-white p-8 md:p-12 rounded-xl border border-gray-200 shadow-sm">
                <!-- Bid Content (Truncated for brevity, fully functional via JS) -->
                <div class="flex justify-between items-start mb-12 border-b border-gray-200 pb-8">
                    <div>
                        <h2 class="text-3xl font-bold text-gray-900 tracking-tight">BID PROPOSAL</h2>
                        <div class="mt-4 text-sm text-gray-600 leading-relaxed">
                            <strong>5B Contracting</strong><br>123 Dirt Road Ave<br>Montgomery, AL 36104<br>(334) 555-0198
                        </div>
                    </div>
                </div>
                
                <h3 class="text-lg font-bold text-gray-900 mb-4 border-b-2 border-brand pb-2">Scope of Work & Pricing</h3>
                <table class="w-full text-left" id="line-items-table">
                    <thead>
                        <tr class="text-xs font-bold text-gray-500 uppercase tracking-wider border-b border-gray-200 bg-gray-50">
                            <th class="p-3 w-1/4">Category</th>
                            <th class="p-3 w-1/3">Description</th>
                            <th class="p-3 w-24 text-center">Qty</th>
                            <th class="p-3 w-32 text-right">Unit Cost</th>
                            <th class="p-3 w-32 text-right">Total</th>
                        </tr>
                    </thead>
                    <tbody id="line-items-body" class="text-sm"></tbody>
                </table>
                <button onclick="addLineItem()" class="no-print mt-4 text-brand-dark font-medium text-sm hover:underline"><i class="fa-solid fa-circle-plus"></i> Add Item</button>

                <div class="flex justify-end border-t border-gray-200 pt-6">
                    <div class="w-72">
                        <div class="flex justify-between py-2 text-sm">
                            <span class="text-gray-500">Subtotal:</span>
                            <span id="subtotal-val" class="font-medium">$0.00</span>
                        </div>
                        <div class="flex justify-between py-3 mt-2 border-t-2 border-gray-800 text-lg font-bold">
                            <span class="text-gray-900">Total Bid:</span>
                            <span id="grand-total-val" class="text-brand-dark">$0.00</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ========================================== -->
        <!-- VIEW: CLIENTS (MVP) -->
        <!-- ========================================== -->
        <div id="view-clients" class="fade-in hidden">
            <div class="bg-white rounded-xl border border-gray-200 shadow-sm overflow-hidden">
                <table class="w-full text-left border-collapse">
                    <thead>
                        <tr class="bg-gray-50 text-gray-500 text-sm border-b border-gray-200">
                            <th class="px-6 py-4 font-medium">Company Name</th>
                            <th class="px-6 py-4 font-medium">Primary Contact</th>
                            <th class="px-6 py-4 font-medium">Email Address</th>
                        </tr>
                    </thead>
                    <tbody class="text-sm" id="clients-body"></tbody>
                </table>
            </div>
        </div>

        <!-- ========================================== -->
        <!-- VIEW: RATE CARD (MVP) -->
        <!-- ========================================== -->
        <div id="view-rate-card" class="fade-in hidden">
            <div class="bg-white rounded-xl border border-gray-200 shadow-sm overflow-hidden">
                <table class="w-full text-left border-collapse">
                    <thead>
                        <tr class="bg-gray-50 text-gray-500 text-sm border-b border-gray-200">
                            <th class="px-6 py-4 font-medium">Category</th>
                            <th class="px-6 py-4 font-medium">Description</th>
                            <th class="px-6 py-4 font-medium text-right">Unit Cost</th>
                        </tr>
                    </thead>
                    <tbody class="text-sm" id="rate-card-body"></tbody>
                </table>
            </div>
        </div>

    </main>

    <!-- JavaScript Logic -->
    <script>
        // ==========================================
        // 1. DATA STATE (MVP + Q2 DUMMY DATA)
        // ==========================================
        let lineItems =[
            { id: 1, category: 'Mobilization', desc: 'Move in equipment', qty: 1, cost: 1500.00 },
            { id: 2, category: 'Excavation', desc: 'Cut to subgrade', qty: 1200, cost: 12.50 }
        ];

        const clientsData =[
            { id: 1, company: 'Apex Development', contact: 'John Smith', email: 'john@apexdev.com' },
            { id: 2, company: 'Montgomery Muni', contact: 'Sarah Jenkins', email: 'sjenkins@montgomeryal.gov' }
        ];

        const rateCardData =[
            { id: 1, cat: 'Equipment', desc: 'Cat 320 Excavator', cost: 125.00 },
            { id: 2, cat: 'Labor', desc: 'Operator - Heavy', cost: 45.00 }
        ];

        // Q2 Features Data
        const jobCostingData =[
            { id: 1, project: 'Highland Subdiv Phase 1', client: 'Apex Dev', est: 45000, actual: 38500, status: 'In Progress' },
            { id: 2, project: 'Smith Foundation Dig', client: 'Smith Family', est: 12400, actual: 13100, status: 'Over Budget' },
            { id: 3, project: 'City Water Main', client: 'Montgomery Muni', est: 128500, actual: 42000, status: 'Started' }
        ];

        const equipmentData =[
            { id: 'EQ-01', name: 'Cat 320 Excavator', type: 'Excavator', status: 'Active', location: 'Highland Subdiv', hours: 4520, nextService: '4600 hrs' },
            { id: 'EQ-04', name: 'Deere 35G Mini', type: 'Excavator', status: 'Maintenance', location: 'Shop', hours: 1250, nextService: 'In Shop (Hydraulics)' },
            { id: 'EQ-08', name: 'JD 650K Dozer', type: 'Dozer', status: 'Active', location: 'City Water Main', hours: 3100, nextService: '3200 hrs' },
            { id: 'EQ-12', name: 'Mack Dump Truck', type: 'Truck', status: 'Idle', location: 'Yard', hours: 8540, nextService: '9000 hrs' },
            { id: 'EQ-15', name: 'Cat 289D Skid Steer', type: 'Loader', status: 'Active', location: 'Smith Foundation', hours: 2100, nextService: '2500 hrs' }
        ];

        const portalData =[
            { client: 'Apex Development', active: 2, pending: 1, lastLogin: 'Today, 9:45 AM', code: 'apx-8f2a' },
            { client: 'Montgomery Muni', active: 1, pending: 2, lastLogin: 'Yesterday', code: 'mty-9c1x' },
            { client: 'Smith Family Farms', active: 0, pending: 1, lastLogin: 'Feb 20, 2026', code: 'smf-3b4z' }
        ];

        // ==========================================
        // 2. VIEW SWITCHING LOGIC
        // ==========================================
        const views =['dashboard', 'bid-editor', 'clients', 'rate-card', 'job-costing', 'equipment', 'portal'];
        
        function switchView(viewName) {
            // Hide all
            views.forEach(v => {
                document.getElementById('view-' + v).classList.add('hidden');
                const navBtn = document.getElementById('nav-' + v);
                navBtn.classList.remove('bg-gray-800', 'text-white', 'text-brand');
                navBtn.classList.add('text-gray-400');
            });
            
            // Show target
            document.getElementById('view-' + viewName).classList.remove('hidden');
            const activeNav = document.getElementById('nav-' + viewName);
            activeNav.classList.remove('text-gray-400');
            activeNav.classList.add('bg-gray-800', viewName === 'dashboard' ? 'text-brand' : 'text-white');

            // Dynamic Header Text
            const title = document.getElementById('page-title');
            const sub = document.getElementById('page-subtitle');
            const actions = document.getElementById('header-actions');
            
            const headers = {
                'dashboard': { t: 'Dashboard Overview', s: "Welcome back. Here's your pipeline status.", a: '<button onclick="switchView(\'bid-editor\')" class="px-4 py-2 bg-brand text-dark font-bold rounded-lg hover:bg-brand-dark shadow-sm transition"><i class="fa-solid fa-plus mr-2"></i>New Bid</button>' },
                'bid-editor': { t: 'Bid Editor', s: 'Editing: Highland Subdivision Phase 2', a: '' },
                'clients': { t: 'Client Database', s: 'Manage your customers and contacts.', a: '<button class="px-4 py-2 bg-brand text-dark font-bold rounded-lg hover:bg-brand-dark shadow-sm"><i class="fa-solid fa-user-plus mr-2"></i>Add Client</button>' },
                'rate-card': { t: 'Rate Card', s: 'Standard pricing for estimating.', a: '<button class="px-4 py-2 bg-brand text-dark font-bold rounded-lg hover:bg-brand-dark shadow-sm"><i class="fa-solid fa-tag mr-2"></i>Add Rate</button>' },
                'job-costing': { t: 'Job Costing (WIP)', s: 'Track estimated vs actual costs in real-time.', a: '<button class="px-4 py-2 bg-white border border-gray-300 rounded-lg text-sm font-medium hover:bg-gray-50"><i class="fa-solid fa-file-csv mr-2"></i>Export CSV</button>' },
                'equipment': { t: 'Equipment Fleet', s: 'Track machine locations, hours, and maintenance.', a: '<button class="px-4 py-2 bg-brand text-dark font-bold rounded-lg hover:bg-brand-dark shadow-sm"><i class="fa-solid fa-plus mr-2"></i>Add Machine</button>' },
                'portal': { t: 'Client Portals', s: 'Manage external access links for your clients.', a: '' }
            };

            title.innerText = headers[viewName].t;
            sub.innerText = headers[viewName].s;
            actions.innerHTML = headers[viewName].a;

            // Trigger animations for progress bars if entering job costing
            if(viewName === 'job-costing') {
                setTimeout(() => {
                    document.querySelectorAll('.progress-bar').forEach(bar => {
                        bar.style.width = bar.getAttribute('data-width');
                    });
                }, 100);
            }
        }

        // ==========================================
        // 3. RENDER FUNCTIONS (MVP)
        // ==========================================
        function renderLineItems() {
            const tbody = document.getElementById('line-items-body');
            tbody.innerHTML = '';
            let sub = 0;
            lineItems.forEach((item, index) => {
                const total = item.qty * item.cost;
                sub += total;
                tbody.innerHTML += `
                    <tr class="border-b border-gray-100 hover:bg-gray-50">
                        <td class="p-3 text-gray-600">${item.category}</td>
                        <td class="p-3 text-gray-900">${item.desc}</td>
                        <td class="p-3 text-center">${item.qty}</td>
                        <td class="p-3 text-right">$${item.cost.toFixed(2)}</td>
                        <td class="p-3 text-right font-medium">$${total.toLocaleString()}</td>
                    </tr>`;
            });
            document.getElementById('subtotal-val').innerText = `$${sub.toLocaleString()}`;
            document.getElementById('grand-total-val').innerText = `$${(sub * 1.15).toLocaleString()}`; // 15% arbitrary markup for simplicity here
        }

        function renderClients() {
            const tbody = document.getElementById('clients-body');
            clientsData.forEach(c => {
                tbody.innerHTML += `<tr class="border-b border-gray-100"><td class="px-6 py-4 font-bold text-gray-900">${c.company}</td><td class="px-6 py-4">${c.contact}</td><td class="px-6 py-4 text-blue-600">${c.email}</td></tr>`;
            });
        }

        function renderRateCard() {
            const tbody = document.getElementById('rate-card-body');
            rateCardData.forEach(r => {
                tbody.innerHTML += `<tr class="border-b border-gray-100"><td class="px-6 py-4 font-bold text-gray-500">${r.cat}</td><td class="px-6 py-4">${r.desc}</td><td class="px-6 py-4 text-right">$${r.cost.toFixed(2)}</td></tr>`;
            });
        }

        // ==========================================
        // 4. RENDER FUNCTIONS (Q2)
        // ==========================================
        
        function renderJobCosting() {
            const tbody = document.getElementById('job-costing-body');
            let html = '';
            
            jobCostingData.forEach(j => {
                const percent = Math.min((j.actual / j.est) * 100, 100).toFixed(0);
                const isOver = j.actual > j.est;
                const barColor = isOver ? 'bg-red-500' : (percent > 85 ? 'bg-yellow-400' : 'bg-green-500');
                const statusBadge = isOver 
                    ? `<span class="px-2 py-1 bg-red-100 text-red-800 rounded text-xs font-bold">Over Budget</span>` 
                    : `<span class="px-2 py-1 bg-blue-100 text-blue-800 rounded text-xs font-bold">${j.status}</span>`;

                html += `
                    <tr class="border-b border-gray-100 hover:bg-gray-50 transition">
                        <td class="px-6 py-4">
                            <p class="font-bold text-gray-900">${j.project}</p>
                            <p class="text-xs text-gray-500">${j.client}</p>
                        </td>
                        <td class="px-6 py-4 text-right font-medium text-gray-600">$${j.est.toLocaleString()}</td>
                        <td class="px-6 py-4 text-right font-bold ${isOver ? 'text-red-600' : 'text-gray-900'}">$${j.actual.toLocaleString()}</td>
                        <td class="px-6 py-4">
                            <div class="flex items-center justify-between text-xs mb-1">
                                <span>${percent}%</span>
                                ${isOver ? '<span class="text-red-500"><i class="fa-solid fa-triangle-exclamation"></i></span>' : ''}
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2">
                                <div class="${barColor} h-2 rounded-full progress-bar" style="width: 0%;" data-width="${percent}%"></div>
                            </div>
                        </td>
                        <td class="px-6 py-4 text-center">${statusBadge}</td>
                    </tr>
                `;
            });
            tbody.innerHTML = html;
        }

        function renderEquipment() {
            const grid = document.getElementById('equipment-grid');
            let html = '';

            equipmentData.forEach(eq => {
                // Status styles
                let iconClass = 'fa-tractor';
                if(eq.type === 'Truck') iconClass = 'fa-truck';
                
                let dotColor = 'bg-green-500';
                if(eq.status === 'Idle') dotColor = 'bg-yellow-500';
                if(eq.status === 'Maintenance') dotColor = 'bg-red-500';

                html += `
                    <div class="bg-white rounded-xl border border-gray-200 shadow-sm p-5 hover:shadow-md transition cursor-pointer">
                        <div class="flex justify-between items-start mb-4">
                            <div class="flex gap-3 items-center">
                                <div class="w-10 h-10 rounded-lg bg-gray-100 text-gray-600 flex items-center justify-center text-lg">
                                    <i class="fa-solid ${iconClass}"></i>
                                </div>
                                <div>
                                    <h3 class="font-bold text-gray-900">${eq.name}</h3>
                                    <p class="text-xs text-gray-500 uppercase tracking-wider">${eq.id}</p>
                                </div>
                            </div>
                            <span class="flex items-center gap-1.5 text-xs font-medium px-2 py-1 bg-gray-50 rounded-md border border-gray-100">
                                <span class="w-2 h-2 rounded-full ${dotColor}"></span> ${eq.status}
                            </span>
                        </div>
                        
                        <div class="space-y-2 mb-4">
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-500"><i class="fa-solid fa-location-dot w-4 text-center mr-1"></i> Location</span>
                                <span class="font-medium text-gray-800">${eq.location}</span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-500"><i class="fa-regular fa-clock w-4 text-center mr-1"></i> Meter Hours</span>
                                <span class="font-medium text-gray-800">${eq.hours.toLocaleString()}</span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-500"><i class="fa-solid fa-wrench w-4 text-center mr-1"></i> Next Service</span>
                                <span class="${eq.status === 'Maintenance' ? 'text-red-500 font-bold' : 'font-medium text-gray-800'}">${eq.nextService}</span>
                            </div>
                        </div>
                        
                        <button class="w-full py-2 border border-gray-200 text-gray-600 text-sm font-medium rounded-lg hover:bg-gray-50 transition">
                            View Logs
                        </button>
                    </div>
                `;
            });
            grid.innerHTML = html;
        }

        function renderPortals() {
            const tbody = document.getElementById('portal-body');
            let html = '';

            portalData.forEach(p => {
                html += `
                    <tr class="border-b border-gray-100 hover:bg-gray-50 transition">
                        <td class="px-6 py-4">
                            <p class="font-bold text-gray-900">${p.client}</p>
                        </td>
                        <td class="px-6 py-4 text-center font-medium text-gray-700">${p.active}</td>
                        <td class="px-6 py-4 text-center font-medium text-gray-700">${p.pending}</td>
                        <td class="px-6 py-4 text-sm text-gray-500">${p.lastLogin}</td>
                        <td class="px-6 py-4 text-right">
                            <a href="#" class="text-sm text-brand-dark hover:underline mr-4">Preview Portal</a>
                            <button class="px-3 py-1.5 bg-gray-100 text-gray-700 hover:bg-gray-200 rounded text-sm font-medium border border-gray-300 transition flex items-center gap-2 inline-flex">
                                <i class="fa-regular fa-copy"></i> Copy Link
                            </button>
                        </td>
                    </tr>
                `;
            });
            tbody.innerHTML = html;
        }

        // ==========================================
        // 5. CHART INITIALIZATION
        // ==========================================
        function initCharts() {
            new Chart(document.getElementById('revenueChart').getContext('2d'), {
                type: 'line',
                data: {
                    labels:['Sep', 'Oct', 'Nov', 'Dec', 'Jan', 'Feb'],
                    datasets:[{ label: 'Revenue', data:[150000, 180000, 120000, 210000, 250000, 290000], borderColor: '#eab308', backgroundColor: 'rgba(234, 179, 8, 0.1)', borderWidth: 3, tension: 0.3, fill: true }]
                },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: {display: false} } }
            });
            new Chart(document.getElementById('pipelineChart').getContext('2d'), {
                type: 'doughnut',
                data: {
                    labels:['Draft', 'Submitted', 'Negotiation'],
                    datasets:[{ data:[45000, 250000, 130000], backgroundColor:['#fef08a', '#3b82f6', '#ca8a04'], borderWidth: 0 }]
                },
                options: { responsive: true, maintainAspectRatio: false, cutout: '70%', plugins: { legend: { position: 'bottom' } } }
            });
        }

        // Bid data
const bidsData = {
    1: { name: 'Highland Subdivision Phase 2', client: 'Apex Development', items: [{ category: 'Mobilization', desc: 'Move in', qty: 1, cost: 1500 },{ category: 'Excavation', desc: 'Cut to subgrade', qty: 1200, cost: 12.50 }]},
    2: { name: 'Eastdale Commons', client: 'Coleman Dev', items: [{ category: 'Mobilization', desc: 'Move in', qty: 1, cost: 2500 }]},
    3: { name: 'VA Hospital', client: 'US Govt', items: [{ category: 'Mobilization', desc: 'Move in', qty: 1, cost: 1200 }]},
    4: { name: 'Downtown Mixed-Use', client: 'Capital City', items: [{ category: 'Mobilization', desc: 'Move in', qty: 1, cost: 3000 }]}
};

function loadBid(id) {
    const bid = bidsData[id];
    document.getElementById('page-subtitle').innerText = 'Editing: ' + bid.name;
    let subtotal = 0;
    let html = '';
    bid.items.forEach(item => {
        const total = item.qty * item.cost;
        subtotal += total;
        html += '<tr><td>'+item.category+'</td><td>'+item.desc+'</td><td class="text-center">'+item.qty+'</td><td class="text-right">$'+item.cost.toFixed(2)+'</td><td class="text-right font-medium">$'+total.toLocaleString()+'</td></tr>';
    });
    document.getElementById('line-items-body').innerHTML = html;
    document.getElementById('subtotal-val').innerText = '$'+subtotal.toLocaleString();
    document.getElementById('grand-total-val').innerText = '$'+(subtotal*1.15).toLocaleString();
}

// Initialize Everything on Load
        window.onload = () => {
            renderLineItems();
            renderClients();
            renderRateCard();
            renderJobCosting();
            renderEquipment();
            renderPortals();
            initCharts();
        };
    </script>
</body>
</html>