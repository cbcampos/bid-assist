<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BidAssist - 5B Contracting</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --primary: #1a5632; --surface: #fff; --bg: #f5f7f6; --text: #1a1a1a; --text2: #5a6a6a; --border: #e0e8e5; --success: #22c55e; --warning: #f59e0b; --danger: #ef4444; --radius: 12px; }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); min-height: 100vh; }
        .header { background: var(--primary); color: white; padding: 1rem 2rem; display: flex; justify-content: space-between; align-items: center; }
        .header h1 { font-size: 1.5rem; }
        .nav { display: flex; gap: 0.5rem; }
        .nav button; border: none { background: none; color: white; cursor: pointer; opacity: 0.8; font-size: 0.85rem; padding: 0.4rem 0.8rem; border-radius: 6px; }
        .nav button:hover, .nav button.active { opacity: 1; background: rgba(255,255,255,0.15); }
        .container { max-width: 1200px; margin: 0 auto; padding: 1.5rem; }
        .stats { display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; margin-bottom: 1.5rem; }
        .stat-card { background: var(--surface); padding: 1rem; border-radius: var(--radius); box-shadow: 0 1px 3px rgba(0,0,0,0.08); }
        .stat-value { font-size: 1.5rem; font-weight: 700; color: var(--primary); }
        .stat-label { font-size: 0.75rem; color: var(--text2); margin-top: 0.25rem; }
        .card { background: var(--surface); border-radius: var(--radius); padding: 1.25rem; margin-bottom: 1rem; box-shadow: 0 1px 3px rgba(0,0,0,0.08); }
        .card-header { display: flex; justify-content: space-between; margin-bottom: 1rem; }
        .card-title { font-weight: 600; font-size: 1.1rem; }
        .btn { padding: 0.5rem 1rem; border-radius: 8px; border: none; font-weight: 500; cursor: pointer; font-size: 0.9rem; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-secondary { background: var(--surface); border: 1px solid var(--border); }
        .btn-sm { padding: 0.3rem 0.6rem; font-size: 0.8rem; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 1rem; }
        .project-card { border: 1px solid var(--border); border-radius: var(--radius); padding: 1rem; cursor: pointer; transition: 0.2s; }
        .project-card:hover { border-color: var(--primary); box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .project-name { font-weight: 600; font-size: 1rem; }
        .project-client { color: var(--text2); font-size: 0.85rem; }
        .project-meta { display: flex; justify-content: space-between; margin-top: 0.75rem; padding-top: 0.75rem; border-top: 1px solid var(--border); }
        .project-total { font-weight: 700; color: var(--primary); }
        .badge { padding: 0.2rem 0.5rem; border-radius: 20px; font-size: 0.7rem; font-weight: 500; }
        .badge-draft { background: #fef3c7; color: #92400e; }
        .badge-submitted { background: #dbeafe; color: #1e40af; }
        .badge-won { background: #dcfce7; color: #166534; }
        .badge-lost { background: #fee2e2; color: #991b1b; }
        .form-group { margin-bottom: 0.75rem; }
        .form-label { display: block; font-weight: 500; margin-bottom: 0.3rem; font-size: 0.85rem; }
        .form-input, .form-select { width: 100%; padding: 0.6rem; border: 1px solid var(--border); border-radius: 8px; font-size: 0.9rem; }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem; }
        .modal-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 1000; justify-content: center; align-items: center; }
        .modal { background: white; padding: 1.5rem; border-radius: var(--radius); max-width: 600px; width: 95%; max-height: 90vh; overflow-y: auto; }
        .modal-header { display: flex; justify-content: space-between; margin-bottom: 1rem; }
        .modal-header h2 { font-size: 1.2rem; }
        .close-btn { background: none; border: none; font-size: 1.5rem; cursor: pointer; color: var(--text2); }
        .detail-header { display: flex; justify-content: space-between; margin-bottom: 1.5rem; flex-wrap: wrap; gap: 1rem; }
        .detail-title { font-size: 1.5rem; font-weight: 700; }
        .detail-client { color: var(--text2); }
        .totals-card { background: linear-gradient(135deg, var(--primary) 0%, #007580 100%); color: white; padding: 1.5rem; border-radius: var(--radius); margin-bottom: 1.5rem; }
        .totals-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; margin-top: 1rem; }
        .total-item { text-align: center; }
        .total-label { font-size: 0.75rem; opacity: 0.9; }
        .total-value { font-size: 1.25rem; font-weight: 700; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 0.6rem; text-align: left; border-bottom: 1px solid var(--border); font-size: 0.85rem; }
        th { font-weight: 600; color: var(--text2); font-size: 0.75rem; text-transform: uppercase; }
        .text-right { text-align: right; }
        .empty { text-align: center; padding: 2rem; color: var(--text2); }
        .history-stat { text-align: center; padding: 1rem; background: var(--surface); border-radius: var(--radius); }
        .history-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; margin-bottom: 1.5rem; }
        .chart-container { height: 250px; margin-bottom: 1rem; }
        .pipeline { display: flex; gap: 1rem; overflow-x: auto; padding-bottom: 0.5rem; }
        .pipeline-col { min-width: 220px; background: var(--bg); border-radius: var(--radius); padding: 1rem; }
        .pipeline-col h4 { font-size: 0.85rem; color: var(--text2); margin-bottom: 0.75rem; }
        .pipeline-item { background: var(--surface); padding: 0.75rem; border-radius: 8px; margin-bottom: 0.5rem; cursor: pointer; border: 1px solid var(--border); }
        .pipeline-item:hover { border-color: var(--primary); }
        .client-card { border: 1px solid var(--border); border-radius: var(--radius); padding: 1rem; }
        .client-card:hover { border-color: var(--primary); }
        .client-name { font-weight: 600; }
        .client-email { font-size: 0.85rem; color: var(--text2); }
        .client-projects { font-size: 0.8rem; color: var(--primary); margin-top: 0.5rem; }
        .hidden { display: none; }
        .action-btns { display: flex; gap: 0.5rem; flex-wrap: wrap; }
        .email-form textarea { width: 100%; padding: 0.6rem; border: 1px solid var(--border); border-radius: 8px; min-height: 100px; resize: vertical; }
        .email-status { padding: 0.75rem; border-radius: 8px; margin-top: 1rem; }
        .email-status.success { background: #dcfce7; color: #166534; }
        .email-status.error { background: #fee2e2; color: #991b1b; }
        @media (max-width: 768px) { .stats { grid-template-columns: repeat(2, 1fr); } .form-row { grid-template-columns: 1fr; } .grid { grid-template-columns: 1fr; } .totals-grid { grid-template-columns: repeat(2, 1fr); } .history-grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <div class="header">
        <h1>5B Contracting - BidAssist</h1>
        <div class="nav">
            <button class="active" onclick="showView('dashboard')">Projects</button>
            <button onclick="showView('analytics')">Analytics</button>
            <button onclick="showView('clients')">Clients</button>
            <button onclick="showView('history')">History</button>
            <button onclick="showView('rates')">Rates</button>
        </div>
    </div>
    
    <!-- Dashboard -->
    <div id="dashboard" class="container">
        <div class="stats">
            <div class="stat-card"><div class="stat-value" id="stat-total">0</div><div class="stat-label">Total Projects</div></div>
            <div class="stat-card"><div class="stat-value" id="stat-active">0</div><div class="stat-label">Active Bids</div></div>
            <div class="stat-card"><div class="stat-value" id="stat-won">$0</div><div class="stat-label">Won This Month</div></div>
            <div class="stat-card"><div class="stat-value" id="stat-pending">$0</div><div class="stat-label">Pending</div></div>
        </div>
        <div class="card">
            <div class="card-header"><div class="card-title">Projects</div><button class="btn btn-primary" onclick="showModal('project')">+ New Project</button></div>
            <div class="grid" id="projectList"></div>
        </div>
    </div>
    
    <!-- Analytics -->
    <div id="analytics" class="container hidden">
        <div class="history-grid">
            <div class="history-stat"><div class="stat-value" id="hist-winrate">0%</div><div class="stat-label">Win Rate</div></div>
            <div class="history-stat"><div class="stat-value" id="hist-avg">$0</div><div class="stat-label">Avg Bid</div></div>
            <div class="history-stat"><div class="stat-value" id="hist-total">$0</div><div class="stat-label">Total Won</div></div>
        </div>
        <div class="card">
            <div class="card-title">Win Rate Trend</div>
            <div class="chart-container"><canvas id="winRateChart"></canvas></div>
        </div>
        <div class="card">
            <div class="card-title">Revenue by Month</div>
            <div class="chart-container"><canvas id="revenueChart"></canvas></div>
        </div>
        <div class="card">
            <div class="card-title">Pipeline</div>
            <div class="pipeline" id="pipeline"></div>
        </div>
    </div>
    
    <!-- Clients -->
    <div id="clients" class="container hidden">
        <div class="card">
            <div class="card-header"><div class="card-title">Client Database</div><button class="btn btn-primary" onclick="showModal('client')">+ Add Client</button></div>
            <div class="grid" id="clientList"></div>
        </div>
    </div>
    
    <!-- History -->
    <div id="history" class="container hidden">
        <div class="card"><div class="card-title">Bid History</div>
        <table><thead><tr><th>Project</th><th>Client</th><th class="text-right">Bid</th><th>Status</th><th>Deadline</th></tr></thead><tbody id="historyList"></tbody></table></div>
    </div>
    
    <!-- Rates -->
    <div id="rates" class="container hidden">
        <div class="card"><div class="card-header"><div class="card-title">Rate Card</div><button class="btn btn-primary" onclick="showModal('rate')">+ Add Rate</button></div>
        <table><thead><tr><th>Category</th><th>Description</th><th class="text-right">Unit Cost</th><th>Unit</th></tr></thead><tbody id="rateList"></tbody></table></div>
    </div>
    
    <!-- Project Detail -->
    <div id="detail" class="container hidden">
        <button class="btn btn-secondary" onclick="showView('dashboard')" style="margin-bottom:1rem">← Back</button>
        <div class="detail-header">
            <div><div class="detail-title" id="detail-name"></div><div class="detail-client" id="detail-client"></div></div>
            <div class="action-btns">
                <button class="btn btn-secondary btn-sm" onclick="updateStatus('won')">Mark Won</button>
                <button class="btn btn-secondary btn-sm" onclick="updateStatus('lost')">Mark Lost</button>
                <button class="btn btn-secondary btn-sm" onclick="showModal('email')">Email Bid</button>
                <button class="btn btn-primary btn-sm" onclick="printBid()">Print/PDF</button>
            </div>
        </div>
        <div class="totals-card">
            <div>Bid Total</div>
            <div class="totals-grid">
                <div class="total-item"><div class="total-label">Subtotal</div><div class="total-value" id="total-sub">$0</div></div>
                <div class="total-item"><div class="total-label">Overhead</div><div class="total-value" id="total-overhead">$0</div></div>
                <div class="total-item"><div class="total-label">Profit</div><div class="total-value" id="total-profit">$0</div></div>
                <div class="total-item"><div class="total-label">Total</div><div class="total-value" id="total-final">$0</div></div>
            </div>
        </div>
        <div class="card"><div class="card-title">Line Items</div><div id="lineItems"></div></div>
    </div>
    
    <!-- Modals -->
    <div id="projectModal" class="modal-overlay"><div class="modal"><div class="modal-header"><h2>New Project</h2><button class="close-btn" onclick="hideModal('project')">×</button></div>
        <form onsubmit="saveProject(event)">
            <div class="form-group"><label class="form-label">Project Name</label><input type="text" class="form-input" name="name" required></div>
            <div class="form-row"><div class="form-group"><label class="form-label">Client</label><select class="form-select" name="client" id="projectClientSelect" required></select></div><div class="form-group"><label class="form-label">Deadline</label><input type="date" class="form-input" name="deadline" required></div></div>
            <div class="form-group"><label class="form-label">Address</label><input type="text" class="form-input" name="address"></div>
            <div class="form-row"><div class="form-group"><label class="form-label">Overhead %</label><input type="number" class="form-input" name="overhead" value="15"></div><div class="form-group"><label class="form-label">Profit %</label><input type="number" class="form-input" name="profit" value="10"></div></div>
            <button type="submit" class="btn btn-primary" style="width:100%">Create Project</button>
        </form></div></div>
    
    <div id="clientModal" class="modal-overlay"><div class="modal"><div class="modal-header"><h2>Add Client</h2><button class="close-btn" onclick="hideModal('client')">×</button></div>
        <form onsubmit="saveClient(event)">
            <div class="form-group"><label class="form-label">Company Name</label><input type="text" class="form-input" name="company" required></div>
            <div class="form-group"><label class="form-label">Contact Name</label><input type="text" class="form-input" name="contact"></div>
            <div class="form-row"><div class="form-group"><label class="form-label">Email</label><input type="email" class="form-input" name="email"></div><div class="form-group"><label class="form-label">Phone</label><input type="tel" class="form-input" name="phone"></div></div>
            <div class="form-group"><label class="form-label">Notes</label><textarea class="form-input" name="notes" rows="2"></textarea></div>
            <button type="submit" class="btn btn-primary" style="width:100%">Save Client</button>
        </form></div></div>
    
    <div id="rateModal" class="modal-overlay"><div class="modal"><div class="modal-header"><h2>Add Rate</h2><button class="close-btn" onclick="hideModal('rate')">×</button></div>
        <form onsubmit="saveRate(event)">
            <div class="form-group"><label class="form-label">Category</label><input type="text" class="form-input" name="category" required></div>
            <div class="form-group"><label class="form-label">Description</label><input type="text" class="form-input" name="description"></div>
            <div class="form-row"><div class="form-group"><label class="form-label">Unit Cost</label><input type="number" class="form-input" name="unit_cost" step="0.01" required></div><div class="form-group"><label class="form-label">Unit</label><input type="text" class="form-input" name="unit" required></div></div>
            <button type="submit" class="btn btn-primary" style="width:100%">Add Rate</button>
        </form></div></div>
    
    <div id="emailModal" class="modal-overlay"><div class="modal"><div class="modal-header"><h2>Email Bid</h2><button class="close-btn" onclick="hideModal('email')">×</button></div>
        <form onsubmit="sendEmail(event)" class="email-form">
            <div class="form-group"><label class="form-label">To</label><input type="email" class="form-input" name="to" required></div>
            <div class="form-group"><label class="form-label">CC</label><input type="email" class="form-input" name="cc"></div>
            <div class="form-group"><label class="form-label">Subject</label><input type="text" class="form-input" name="subject" value="Bid Proposal"></div>
            <div class="form-group"><label class="form-label">Message</label><textarea name="message" rows="4">Please find attached our bid proposal.</textarea></div>
            <div id="emailStatus"></div>
            <button type="submit" class="btn btn-primary" style="width:100%">Send with PDF</button>
        </form></div></div>

    <script>
    // Data
    const projects = [
        {id:1,name:"Eastdale Commons Shopping Center",client:"Coleman Development Group",clientId:1,address:"2800 Eastdale Circle, Montgomery, AL 36117",deadline:"2026-03-15",total:87500,status:"submitted",overhead:15,profit:12,line_items:[{category:"Excavation",description:"Building pad excavation",quantity:4500,unit_cost:4.5},{category:"Excavation",description:"Storm drain trench",quantity:1200,unit_cost:5.5},{category:"Backfill",description:"Backfill for utilities",quantity:2800,unit_cost:18},{category:"Import Fill",description:"Select fill for parking",quantity:3200,unit_cost:32},{category:"Haul Off",description:"Excess soil removal",quantity:1900,unit_cost:28},{category:"Trench Box",description:"Trench safety rental",quantity:8,unit_cost:250},{category:"Operator",description:"3 crew members",quantity:40,unit_cost:65}]},
        {id:2,name:"Hillside Residential Phase 2",client:"Southern Homes LLC",clientId:2,address:"4500 Hillside Dr, Montgomery, AL 36109",deadline:"2026-03-08",total:142000,status:"won",overhead:15,profit:15,line_items:[{category:"Excavation",description:"Lot clearing",quantity:8500,unit_cost:4},{category:"Excavation",description:"Street grading",quantity:4200,unit_cost:4.2},{category:"Backfill",description:"Utility trench",quantity:5600,unit_cost:18},{category:"Import Fill",description:"Driveway stone",quantity:1800,unit_cost:35},{category:"Haul Off",description:"Debris removal",quantity:420,unit_cost:45},{category:"Operator",description:"Equipment operators",quantity:85,unit_cost:65},{category:"Final Grade",description:"Finish grading",quantity:2.5,unit_cost:2500}]},
        {id:3,name:"Downtown Montgomery Mixed-Use",client:"Capital City Developers",clientId:3,address:"125 Commerce St, Montgomery, AL 36104",deadline:"2026-03-20",total:225000,status:"draft",overhead:18,profit:18,line_items:[{category:"Excavation",description:"Deep foundation",quantity:6800,unit_cost:6.5},{category:"Excavation",description:"Basement parking",quantity:4200,unit_cost:5.8},{category:"Backfill",description:"Structural backfill",quantity:5200,unit_cost:22},{category:"Import Fill",description:"CLSM",quantity:1200,unit_cost:65},{category:"Haul Off",description:"Rock and soil",quantity:5800,unit_cost:32},{category:"Trench Box",description:"Commercial trench",quantity:15,unit_cost:350},{category:"Operator",description:"Specialized operators",quantity:120,unit_cost:75},{category:"Dewatering",description:"Well point system",quantity:1,unit_cost:8500}]},
        {id:4,name:"VA Hospital Parking Expansion",client:"US Dept of Veterans Affairs",clientId:4,address:"215 Perry Hill Rd, Montgomery, AL 36109",deadline:"2026-02-28",total:67500,status:"submitted",overhead:12,profit:8,line_items:[{category:"Excavation",description:"Asphalt removal",quantity:2800,unit_cost:2.5},{category:"Excavation",description:"Gravel base",quantity:1900,unit_cost:4.8},{category:"Import Fill",description:"Crushed limestone",quantity:2200,unit_cost:38},{category:"Haul Off",description:"Asphalt and base",quantity:450,unit_cost:35},{category:"Operator",description:"2 operators",quantity:32,unit_cost:65}]},
        {id:5,name:"River Region Medical Utility",client:"River Region Health System",clientId:5,address:"100 Medical Center Dr, Montgomery, AL 36117",deadline:"2026-02-20",total:45000,status:"lost",overhead:15,profit:10,line_items:[{category:"Excavation",description:"Water main trench",quantity:850,unit_cost:6.8},{category:"Excavation",description:"Sewer main trench",quantity:620,unit_cost:7.2},{category:"Backfill",description:"Pipe zone backfill",quantity:980,unit_cost:24},{category:"Haul Off",description:"Material",quantity:490,unit_cost:28},{category:"Operator",description:"Utility crew",quantity:28,unit_cost:70}]},
        {id:6,name:"AUM Site Prep",client:"Auburn University at Montgomery",clientId:6,address:"7400 Eastbrook Dr, Montgomery, AL 36117",deadline:"2026-04-01",total:185000,status:"submitted",overhead:15,profit:14,line_items:[{category:"Excavation",description:"Athletic fields",quantity:12500,unit_cost:4.2},{category:"Excavation",description:"Parking lot subgrade",quantity:5800,unit_cost:4.5},{category:"Backfill",description:"General backfill",quantity:8200,unit_cost:18},{category:"Import Fill",description:"Athletic field mix",quantity:4500,unit_cost:42},{category:"Haul Off",description:"Excess cut",quantity:6800,unit_cost:26},{category:"Operator",description:"5 operators",quantity:95,unit_cost:68},{category:"Final Grade",description:"Fine grade and seed",quantity:4.2,unit_cost:3200}]},
        {id:7,name:"Maxwell AFB Building 805",client:"US Air Force / DCMA",clientId:7,address:"Maxwell AFB, Montgomery, AL 36112",deadline:"2026-03-10",total:38000,status:"won",overhead:15,profit:12,line_items:[{category:"Excavation",description:"HVAC unit pads",quantity:180,unit_cost:8.5},{category:"Excavation",description:"Generator pad",quantity:85,unit_cost:9.2},{category:"Backfill",description:"Utility backfill",quantity:320,unit_cost:22},{category:"Concrete",description:"Pad forming and pour",quantity:12,unit_cost:850},{category:"Operator",description:"Small crew",quantity:18,unit_cost:65}]},
        {id:8,name:"ASU Storm Drain",client:"Alabama State University",clientId:8,address:"915 Jackson St, Montgomery, AL 36104",deadline:"2026-03-25",total:92000,status:"draft",overhead:15,profit:12,line_items:[{category:"Excavation",description:"Storm drain trench",quantity:2400,unit_cost:6.2},{category:"Excavation",description:"Inlet structures",quantity:18,unit_cost:450},{category:"Backfill",description:"Trench backfill",quantity:1800,unit_cost:20},{category:"Haul Off",description:"Excess soil",quantity:600,unit_cost:30},{category:"Operator",description:"Utility crew",quantity:45,unit_cost:68}]}
    ];
    
    const clients = [
        {id:1,company:"Coleman Development Group",contact:"John Coleman",email:"john@coleman-dev.com",phone:"334-555-0101",notes:"Preferred client",projectCount:1},
        {id:2,company:"Southern Homes LLC",contact:"Sarah Mitchell",email:"sarah@southernhomes.com",phone:"334-555-0102",notes:"",projectCount:1},
        {id:3,company:"Capital City Developers",contact:"Mike Roberts",email:"mike@capitalcity.com",phone:"334-555-0103",notes:"New client 2026",projectCount:1},
        {id:4,company:"US Dept of Veterans Affairs",contact:"James Wilson",email:"james.wilson@va.gov",phone:"334-555-0104",notes:"Federal contract",projectCount:1},
        {id:5,company:"River Region Health System",contact:"Dr. Lisa Chen",email:"lchen@rrhs.org",phone:"334-555-0105",notes:"Medical facility",projectCount:1},
        {id:6,company:"Auburn University at Montgomery",contact:"Tom Harris",email:"tharris@aum.edu",phone:"334-555-0106",notes:"Educational institution",projectCount:1},
        {id:7,company:"US Air Force / DCMA",contact:"Col. Mark Stevens",email:"mark.stevens@usaf.mil",phone:"334-555-0107",notes:"Federal - priority",projectCount:1},
        {id:8,company:"Alabama State University",contact:"Angela Brown",email:"abrown@asu.edu",phone:"334-555-0108",notes:"State contract",projectCount:1}
    ];
    
    const rates = [
        {category:"Excavation",description:"Standard cut (common soil)",unit_cost:4.50,unit:"cu yd"},
        {category:"Excavation",description:"Rock excavation (requires blasting)",unit_cost:12.00,unit:"cu yd"},
        {category:"Excavation",description:"Trench digging (utility lines)",unit_cost:6.50,unit:"LF"},
        {category:"Backfill",description:"Native backfill",unit_cost:18.00,unit:"cu yd"},
        {category:"Backfill",description:"Select backfill (sand/gravel)",unit_cost:24.00,unit:"cu yd"},
        {category:"Import Fill",description:"Select fill delivered",unit_cost:32.00,unit:"cu yd"},
        {category:"Import Fill",description:"Crushed limestone",unit_cost:38.00,unit:"cu yd"},
        {category:"Haul Off",description:"Excess soil hauling",unit_cost:28.00,unit:"cu yd"},
        {category:"Equipment",description:"Excavator CAT 320",unit_cost:450.00,unit:"day"},
        {category:"Equipment",description:"Dozer CAT D6",unit_cost:550.00,unit:"day"},
        {category:"Operator",description:"Equipment operator",unit_cost:65.00,unit:"hr"},
        {category:"Operator",description:"Skilled operator",unit_cost:75.00,unit:"hr"},
        {category:"Final Grade",description:"Finish grading/acre",unit_cost:3200.00,unit:"acre"},
        {category:"Dewatering",description:"Well point system",unit_cost:8500.00,unit:"job"}
    ];
    
    let currentProject = null;
    let winRateChart, revenueChart;
    
    // Render functions
    function renderProjects() {
        const list = document.getElementById('projectList');
        if (!projects.length) { list.innerHTML = '<div class="empty">No projects</div>'; return; }
        list.innerHTML = projects.map(p => '<div class="project-card" onclick="viewProject('+p.id+')"><div class="project-name">'+p.name+'</div><div class="project-client">'+p.client+'</div><div class="project-meta"><span>'+(p.deadline?new Date(p.deadline).toLocaleDateString():'No deadline')+'</span><span class="badge badge-'+p.status+'">'+p.status+'</span></div><div class="project-total">$'+p.total.toLocaleString()+'</div></div>').join('');
    }
    
    function renderStats() {
        const active = projects.filter(p => p.status === 'draft' || p.status === 'submitted').length;
        const won = projects.filter(p => p.status === 'won');
        const wonMonth = won.filter(p => new Date(p.deadline).getMonth() === new Date().getMonth()).reduce((s,p) => s + p.total, 0);
        const pending = projects.filter(p => p.status === 'submitted').reduce((s,p) => s + p.total, 0);
        document.getElementById('stat-total').textContent = projects.length;
        document.getElementById('stat-active').textContent = active;
        document.getElementById('stat-won').textContent = '$' + wonMonth.toLocaleString();
        document.getElementById('stat-pending').textContent = '$' + pending.toLocaleString();
    }
    
    function renderClients() {
        const list = document.getElementById('clientList');
        if (!clients.length) { list.innerHTML = '<div class="empty">No clients</div>'; return; }
        list.innerHTML = clients.map(c => '<div class="client-card"><div class="client-name">'+c.company+'</div><div class="client-email">'+c.contact+' | '+c.email+' | '+c.phone+'</div><div class="client-projects">'+c.projectCount+' project(s)</div></div>').join('');
        
        // Populate client dropdown in project form
        const select = document.getElementById('projectClientSelect');
        select.innerHTML = clients.map(c => '<option value="'+c.company+'">'+c.company+'</option>').join('');
    }
    
    function renderHistory() {
        const won = projects.filter(p => p.status === 'won');
        const lost = projects.filter(p => p.status === 'lost');
        const totalWon = won.reduce((s,p) => s + p.total, 0);
        const avg = projects.length ? Math.round(projects.reduce((s,p) => s + (p.total||0), 0)/projects.length) : 0;
        const winRate = (won.length + lost.length) ? Math.round(won.length/(won.length+lost.length)*100) : 0;
        document.getElementById('hist-winrate').textContent = winRate + '%';
        document.getElementById('hist-avg').textContent = '$' + avg.toLocaleString();
        document.getElementById('hist-total').textContent = '$' + totalWon.toLocaleString();
        document.getElementById('historyList').innerHTML = projects.map(p => '<tr onclick="viewProject('+p.id+')" style="cursor:pointer"><td>'+p.name+'</td><td>'+p.client+'</td><td class="text-right">$'+(p.total||0).toLocaleString()+'</td><td><span class="badge badge
